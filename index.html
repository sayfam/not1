<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://accounts.google.com https://cdn.jsdelivr.net https://www.gstatic.com https://www.googleapis.com https://www.gstatic.com/gcm/;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://accounts.google.com;
  img-src 'self' data: https://www.gstatic.com;
  connect-src 'self' https://www.googleapis.com https://accounts.google.com https://securetoken.googleapis.com https://firestore.googleapis.com wss://*.firebaseio.com https://oauth2.googleapis.com/;
  frame-src 'self' https://accounts.google.com https://drive.google.com https://*.google.com;
  font-src 'self' https://fonts.gstatic.com;
  object-src 'none';
">



	




  	<title>Note's</title>
	<link rel="icon" href="lock.png" type="image/png" />
	
    <style>
        body {
            background-color: #1e1e2f;
            color: #ffffff;
            font-family: "Courier New", Courier, monospace;
            max-width: 600px;
            margin: 0 auto;
            padding: 0px 15px;
        }

        h2, h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        input, button {
            font-family: "Courier New", Courier, monospace;
            font-size: 16px;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            border-radius: 5px;
        }

        input {
            background-color: #2a2a40;
            color: #fff;
            border: 1px solid #444;
        }

        button {
            background-color: #03a9f4;
            color: white;
            transition: background 0.3s ease;
        }

        button:hover {
            background-color: #0288d1;
        }

        #guncelleBtn {
            background-color: #8bc34a;
        }

        #guncelleBtn:hover {
            background-color: #689f38;
        }

        #kayitListesi {
            margin-top: 30px;
            border-top: 1px solid #555;
            padding-top: 15px;
        } 
		#kayitListesi  button{
            margin-top: 10px;
            border-top: 1px solid #555;
        
		
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

.listeSatiri {
    background-color: #2a2a40;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.listeSatiri span {
    flex-grow: 1;
    word-break: break-word;
}

.listeSatiri .butonGrubu {
flex-direction: column;
    display: flex;
    gap: 6px;
}

.listeSatiri button {
    font-size: 13px;
    padding: 6px 10px;
    border-radius: 4px;
    border: none;
    width: 80px;
    cursor: pointer;
}

.listeSatiri .duzenleBtn {
    background-color: #f57c00;
    color: white;
}

.listeSatiri .duzenleBtn:hover {
    background-color: #ef6c00;
}

.listeSatiri .silBtn {
    background-color: #e53935;
    color: white;
}

.listeSatiri .silBtn:hover {
    background-color: #c62828;
}

.logoutBtn {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 10px 20px;
  
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
    float: right;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.logoutBtn:hover {
    background-color: #7b1fa2;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}





    #notPopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffffff;
      color: #000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      z-index: 999;
      width: 90%;
      max-width: 500px;
    }

    #notMetni {
      width: 90%;
      height: 200px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }

    .popup-buttons {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
    }

    .popup-buttons button {
      padding: 10px 20px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .saveBtn {
      background-color: #27ae60;
      color: white;
    }

    .cancelBtn {
      background-color: #e74c3c;
      color: white;
    }

    body.popup-acik::before {
      content: "";
      position: fixed;
      top: 0; left: 0; bottom: 0; right: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: 998;
    }

.uc-lu {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.aramaKutusu {
flex: 1; /* T√ºm bo≈üluƒüu kaplasƒ±n */
    position: relative;
}
#kelimeBul {
  flex: 1 1 80%;
  padding: 8px;
  font-size: 16px;
}
.temizleBtn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 14px;
  color: #999;
  display: none;
}
#notEkleBtn {
  flex: 0 0 10%;
  padding: 8px;
  font-size: 16px;
  cursor: pointer;
}

.logoutBtn {
  flex: 0 0 10%;
  padding: 8px;
  font-size: 16px;
  cursor: pointer;
}
#notEkleBtn:hover {
    background-color: #7b1fa2;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

#notBaslik {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    font-weight: bold;
}

.temizleBtn  {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 14px;
  color: #999;
  display: none; /* Ba≈ülangƒ±√ßta gizli */
}



.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  position: relative;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-btn {
  background-color: #4a6fa5;
  color: white;
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-family: "Courier New", Courier, monospace;
  transition: all 0.3s;
}

.dropdown-btn:hover {
  background-color: #3a5a80;
}

.dropdown-content {
  display: none;
  position: absolute;
  right: 0;
  background-color: #2a2a40;
  min-width: 160px;
  box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 5px;
  border: 1px solid #444;
}

.dropdown-content a {
  color: #fff;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 14px;
}

.dropdown-content a:hover {
  background-color: #3a3a5a;
}

.show { display: block; }


/* SweetAlert √∂zelle≈ütirmeleri */
.swal2-popup {
  background: #2a2a40 !important;
  color: #fff !important;
}

.swal2-input, .swal2-textarea {
  background: #1e1e2f !important;
  color: #fff !important;
  border: 1px solid #444 !important;
}

.swal2-textarea {
  height: 100px;
  resize: vertical;
}
    </style>
</head>
<body>

 <!-- Giri≈ü Yapma Ekranƒ± -->
<div id="loginSection">
    <h2>Giri≈ü Yap</h2>
    <input type="email" id="emailInput" placeholder="Email">
    <input type="password" id="passwordInput" placeholder="≈ûifre">
    <button onclick="login()">Giri≈ü Yap</button>
    <p>Hesabƒ±nƒ±z yok mu? <a href="javascript:void(0);" onclick="showSignup()">Kayƒ±t ol</a></p>
</div>

<!-- Kayƒ±t Olma Ekranƒ± -->
<div id="signupSection" style="display:none;">
    <h2>Kayƒ±t Ol</h2>
    <input type="email" id="signupEmail" placeholder="Email">
    <input type="password" id="signupPassword" placeholder="≈ûifre">
    <button onclick="signup()">Kayƒ±t Ol</button>
    <p>Hesabƒ±nƒ±z var mƒ±? <a href="javascript:void(0);" onclick="showLogin()">Giri≈ü yap</a></p>
    <p id="signupMessage" style="color: #8bc34a; display: none;">Kayƒ±t olu≈üturuldu, giri≈ü yapƒ±n.</p>
</div>






  <!-- ƒ∞√ßerik B√∂l√ºm√º -->
  
<div id="kayitListesi" style="display:none;">
<p id="hosgeldinYazi" style="text-align:center; margin-top: 10px; font-weight: bold;"></p>


  <h5 id="notBaslik">Note's</h5>







<div class="uc-lu">
    <button class="logoutBtn" onclick="logout()" title="√áƒ±kƒ±≈ü">üîì</button>
   <div class="aramaKutusu">
    <input type="text" id="kelimeBul" placeholder="Ara">
   <span class="temizleBtn" onclick="temizleInput()">‚ùå</span>
</div>
  <button id="notEkleBtn" title="Not Ekleyin...">üìù</button>
  
<div class="dropdown">
        <button class="dropdown-btn">‚ò∞ Men√º</button>
        <div class="dropdown-content">
            <a href="#" id="iletisimAc">üì© ƒ∞leti≈üim</a>
            <a href="#" id="ayarlarAc">‚öôÔ∏è Ayarlar</a> <a href="#" id="yardimAc">‚ùì Yardƒ±m</a>
			<button onclick="yedekleDrive()">üíæ Drive‚Äôa Yedekle</button>
			<button onclick="driveYedektenYukle()">‚è¨ Drive'dan Geri Y√ºkle</button>
        </div>
    </div>
	
</div>


  <!-- Not Popup Kutusu -->
  <div id="notPopup">
    <h3 style="margin-top: 0;">Notlarƒ±m</h3>
    <textarea id="notMetni" placeholder="Notlarƒ±nƒ±zƒ± buraya yazƒ±n..."></textarea>
    <div  class="popup-buttons">
      <button  class="saveBtn" onclick="notKaydet()">Kaydet</button>
      <button class="cancelBtn" onclick="popupKapat()">ƒ∞ptal</button>
    </div>
  </div>




<div style="text-align:center; margin: 24px 0; color: #aaa;">‚úß ‚ú¶ ‚úß</div>



    <!-- 3 adet input alanƒ± -->
	<div class="content-inbtn" >
    <input  type="text" id="isimInput" placeholder="Bilgi Giriniz...">
    <input  type="text" id="soyadInput" placeholder="Bilgi Giriniz...">
    <input  type="text" id="telefonInput" placeholder="Bilgi Giriniz...">

    <button  id="kaydetBtn" onclick="isimKaydet()">‚ûï Kaydet</button>
    <button  id="guncelleBtn" onclick="isimGuncelle()" style="display:none;">‚úî G√ºncelle</button>
    <button  id="vazgecBtn" style="display: none;">‚úñ Vazge√ß</button>
</div>

    <h3>	‚úçÔ∏è Size Ait Notlar</h3>
    <ul id="isimlerListesi"></ul>
</div>



	

    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>



<script src="https://apis.google.com/js/api.js" async defer></script>

   <script>
   
   
   
    // Firebase konfig√ºrasyonu
        const firebaseConfig = {
            apiKey: "AIzaSyBWj53RpZd_xcWGD-ZLIyXBYz8H9MehM7Y",
            authDomain: "dosya01-7a585.firebaseapp.com",
            databaseURL: "https://dosya01-7a585-default-rtdb.firebaseio.com",
            projectId: "dosya01-7a585",
            storageBucket: "dosya01-7a585.firebasestorage.app",
            messagingSenderId: "502419176600",
            appId: "1:502419176600:web:d4304f2a0bfc30d03ce4ed"
        };
        firebase.initializeApp(firebaseConfig);

        let currentEditKey = null;
		
		  // oturum zamanlayƒ±cƒ±sƒ± start
		let sessionTimeout = null;

function baslatOturumZamani() {
    if (sessionTimeout) clearTimeout(sessionTimeout); // √∂nceki s√ºreyi sƒ±fƒ±rla
    sessionTimeout = setTimeout(() => {
        firebase.auth().signOut().then(() => {
            Swal.fire({
                icon: 'info',
                title: 'Oturum S√ºresi Doldu',
                text: 'L√ºtfen tekrar giri≈ü yapƒ±n.',
                confirmButtonText: 'Tamam'
            }).then(() => {
                document.getElementById('loginSection').style.display = "block";
                document.getElementById('kayitListesi').style.display = "none";
                document.getElementById('signupSection').style.display = "none";
                document.getElementById('emailInput').value = "";
                document.getElementById('passwordInput').value = "";
            });
        });
    }, 30000); // 30 saniye
}

// oturum zamanlayƒ±cƒ±sƒ± finish



        // Kayƒ±t Olma Fonksiyonu
        function signup() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Kayƒ±t ba≈üarƒ±lƒ±: ", user.uid);
                    document.getElementById('signupMessage').style.display = "block"; // Kayƒ±t sonrasƒ± mesajƒ± g√∂ster
                    setTimeout(() => {
                        showLogin(); // Kayƒ±t olduktan sonra giri≈ü ekranƒ±nƒ± g√∂ster
                    }, 2000); // 2 saniye sonra giri≈ü ekranƒ±na ge√ßi≈ü
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert("Hata: " + errorMessage);
                });
        }

        // Giri≈ü Yapma Fonksiyonu
        function login() {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Giri≈ü ba≈üarƒ±lƒ±: ", user.uid);
                    showContent(user.uid); // ƒ∞√ßeriƒüi g√∂ster
					document.getElementById('hosgeldinYazi').textContent = `Ho≈ü geldiniz, ${user.email}`;
					baslatOturumZamani(); // 30 saniyelik oturum s√ºresi ba≈ülatƒ±lƒ±r


                    document.getElementById('loginSection').style.display = "none"; // Giri≈ü ekranƒ±nƒ± gizle
                    document.getElementById('signupSection').style.display = "none"; // Kayƒ±t ekranƒ±nƒ± gizle
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert("Hata: " + errorMessage);
                });
        }

	
	

    // Kayƒ±t Olma Fonksiyonu
  function isimKaydet() {
    const user = firebase.auth().currentUser;
    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    const ad = document.getElementById('isimInput').value.trim();
    const soyad = document.getElementById('soyadInput').value.trim();
    const telefon = document.getElementById('telefonInput').value.trim();

    if (ad === "" && soyad === "" && telefon === "") {
        Swal.fire({
            text: 'L√ºtfen en az bir alanƒ± doldurun!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    // Kullanƒ±cƒ± UID'si ile kayƒ±t yapƒ±ldƒ±ƒüƒ±ndan emin olun
    firebase.database().ref('kayitlar/' + user.uid).push({
        ad: ad,
        soyad: soyad,
        telefon: telefon,
        tarih: new Date().toISOString()
    }).then(() => {
        document.getElementById('isimInput').value = "";
        document.getElementById('soyadInput').value = "";
        document.getElementById('telefonInput').value = "";
    }).catch(error => {
        console.error("Kayƒ±t hatasƒ±:", error);
    });
}

    // Kullanƒ±cƒ±nƒ±n kendi verilerini g√∂r√ºnt√ºleme
function showContent(uid) {
    // √ñnce mevcut dinleyiciyi kaldƒ±r (√∂nemli!)
    firebase.database().ref('kayitlar/' + uid).off();
    
    // Yeni dinleyici ekle
    firebase.database().ref('kayitlar/' + uid).on('value', (snapshot) => {
        const isimler = snapshot.val();
        const isimlerListesi = document.getElementById('isimlerListesi');
        isimlerListesi.innerHTML = "";
        
        if (isimler) {
            for (const key in isimler) {
                if (isimler.hasOwnProperty(key)) {
                    const li = document.createElement('li');
                    li.classList.add('listeSatiri');
                    li.innerHTML = `
                        <div>
                            <span>${isimler[key].ad || ''}</span><br>
                            <span>${isimler[key].soyad || ''}</span><br>
                            <span>${isimler[key].telefon || ''}</span>
                        </div>
                        <div class="butonGrubu">
                            <button class="duzenleBtn" onclick="guncelle('${key}', '${isimler[key].ad || ''}', '${isimler[key].soyad || ''}', '${isimler[key].telefon || ''}')">D√ºzenle</button>
                            <button class="silBtn" onclick="sil('${key}')">Sil</button>
                        </div>
                    `;
                    isimlerListesi.appendChild(li);
                }
            }
        }
    });
    
    document.getElementById('kayitListesi').style.display = "block";
	 // üîΩ Bu satƒ±r eklendi: giri≈ü yapƒ±lƒ±nca arama kutusu odaklansƒ±n
    document.getElementById("kelimeBul").focus();
}
		
   

    // Veriyi silme
  function sil(key) {
    const user = firebase.auth().currentUser;

    Swal.fire({
        title: 'Emin misiniz?',
        text: "Bu kaydƒ± silmek √ºzeresiniz!",
      
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Evet, sil!',
        cancelButtonText: 'ƒ∞ptal'
    }).then((result) => {
        if (result.isConfirmed) {
            firebase.database().ref('kayitlar/' + user.uid + '/' + key).remove()
                .then(() => {
                    Swal.fire(
                        'Silindi!',
                        'Kayƒ±t ba≈üarƒ±yla silindi.',
                        'success'
                    );
                })
                .catch((error) => {
                    Swal.fire(
                        'Hata!',
                        'Kayƒ±t silinirken bir sorun olu≈ütu.',
                        'error'
                    );
                    console.error(error);
                });
        }
    });
}


    // Veriyi g√ºncelleme
    function guncelle(key, ad, soyad, telefon) {
        currentEditKey = key;
        document.getElementById('isimInput').value = ad;
        document.getElementById('soyadInput').value = soyad;
        document.getElementById('telefonInput').value = telefon;
        document.getElementById('guncelleBtn').style.display = "block";
		 document.getElementById('vazgecBtn').style.display = "inline-block";
		document.getElementById('kaydetBtn').style.display = "none"; // KAYDET butonunu gizle
        document.getElementById('guncelleBtn').onclick = () => {
            isimGuncelle(key);
        };
		
    }

    // Veriyi g√ºncelleme
    function isimGuncelle(key) {
        const user = firebase.auth().currentUser;
        const yeniAd = document.getElementById('isimInput').value.trim();
        const yeniSoyad = document.getElementById('soyadInput').value.trim();
        const yeniTelefon = document.getElementById('telefonInput').value.trim();

       if (yeniAd === "" && yeniSoyad === "" && yeniTelefon === "") {
        Swal.fire({
            text: 'L√ºtfen en az bir alanƒ± doldurun!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

        firebase.database().ref('kayitlar/' + user.uid + '/' + key).update({
            ad: yeniAd,
            soyad: yeniSoyad,
            telefon: yeniTelefon
        }).then(() => {
            document.getElementById('guncelleBtn').style.display = "none";
			document.getElementById('vazgecBtn').style.display = "none";
			document.getElementById('kaydetBtn').style.display = "block"; // KAYDET butonunu geri g√∂ster
            document.getElementById('isimInput').value = "";
            document.getElementById('soyadInput').value = "";
            document.getElementById('telefonInput').value = "";
            currentEditKey = null;
			// Ba≈üarƒ± uyarƒ±sƒ±
        Swal.fire({
            icon: 'success',
            title: 'G√ºncellendi!',
            confirmButtonText: 'Tamam'
        });
    }).catch((error) => {
        // Hata durumunda uyarƒ±
        Swal.fire({
            icon: 'error',
            title: 'Hata!',
            confirmButtonText: 'Tamam'
        });
        console.error(error);
        });
    }
	
	//g√ºncelleme esnasƒ±nda vazge√ß butonu dinleme
document.getElementById('vazgecBtn').addEventListener('click', () => {
    // Formu temizle
    document.getElementById('isimInput').value = "";
    document.getElementById('soyadInput').value = "";
    document.getElementById('telefonInput').value = "";

    // Butonlarƒ± ayarla
    document.getElementById('guncelleBtn').style.display = "none";
    document.getElementById('vazgecBtn').style.display = "none";
    document.getElementById('kaydetBtn').style.display = "inline-block";

    currentEditKey = null;
});


    // √áƒ±kƒ±≈ü Yapma Fonksiyonu
  function logout() {
    const user = firebase.auth().currentUser;
    if (user) {
        // Dinleyiciyi kaldƒ±r
        firebase.database().ref('kayitlar/' + user.uid).off();
    }
    
    firebase.auth().signOut().then(() => {
        document.getElementById('loginSection').style.display = "block";
        document.getElementById('kayitListesi').style.display = "none";
        document.getElementById('signupSection').style.display = "none";
        document.getElementById('emailInput').value = "";
        document.getElementById('passwordInput').value = "";
    }).catch((error) => {
        console.error("√áƒ±kƒ±≈ü yapƒ±lamadƒ±: ", error);
    });
}

    // Kayƒ±t Ekranƒ±nƒ± G√∂ster
    function showSignup() {
        document.getElementById('signupSection').style.display = "block";
        document.getElementById('loginSection').style.display = "none";
    }

    // Giri≈ü Yapma Ekranƒ±na G√∂ster
    function showLogin() {
        document.getElementById('loginSection').style.display = "block";
        document.getElementById('signupSection').style.display = "none";
    }
	
	// Arama kutusuna yazƒ±ldƒ±k√ßa filtreleme yapan fonksiyon
    document.getElementById("kelimeBul").addEventListener("input", function () {
        const arama = this.value.toLowerCase();
        const liste = document.querySelectorAll("#isimlerListesi li");

        liste.forEach(function (li) {
            const ad = li.querySelector("div span:nth-child(1)")?.textContent.toLowerCase() || "";
            const soyad = li.querySelector("div span:nth-child(2)")?.textContent.toLowerCase() || "";
            const telefon = li.querySelector("div span:nth-child(3)")?.textContent.toLowerCase() || "";

            if (ad.includes(arama) || soyad.includes(arama) || telefon.includes(arama)) {
                li.style.display = "flex"; // varsa g√∂ster
            } else {
                li.style.display = "none"; // yoksa gizle
            }
        });
    });
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

    // Not Ekle butonu a√ß
    document.getElementById("notEkleBtn").addEventListener("click", () => {
        document.getElementById("notPopup").style.display = "block";
        document.body.classList.add("popup-acik");
        document.getElementById("notMetni").focus();
    });

    // Popup kapat
    function popupKapat() {
        document.getElementById("notPopup").style.display = "none";
        document.body.classList.remove("popup-acik");
        document.getElementById("notMetni").value = "";
    }

 


 
document.addEventListener('click', baslatOturumZamani);
document.addEventListener('keydown', baslatOturumZamani);


  document.addEventListener("DOMContentLoaded", function () {
    const kelimeInput = document.getElementById('kelimeBul');
    const temizleBtn = document.querySelector('.temizleBtn');

    kelimeInput.addEventListener('input', function () {
      if (this.value.trim() !== "") {
        temizleBtn.style.display = "block";
      } else {
        temizleBtn.style.display = "none";
      }
    });

    window.temizleInput = function () {
      kelimeInput.value = "";
      temizleBtn.style.display = "none";
      kelimeInput.focus();
	  // üîΩ Arama filtrelemeyi tetiklemek i√ßin input event'i tetikleniyor
  kelimeInput.dispatchEvent(new Event('input'));
    };
    });
	
	function notKaydet() {
    const metin = document.getElementById("notMetni").value.trim();
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    if (metin.length === 0) return;

    // Aynƒ± yerde, aynƒ± anahtarla set yapƒ±yoruz
    firebase.database().ref('notlar/' + user.uid + '/not').set({
        metin: metin,
        tarih: new Date().toISOString()
    }).then(() => {
        popupKapat();
        notlariListele(); // Listeyi g√ºncelle
    }).catch((error) => {
        console.error("Not kaydedilemedi:", error);
    });
}

// Popup a√ßƒ±lƒ±rken kullanƒ±cƒ± notunu √ßekip textarea'ya yaz
function notGetir() {
    const user = firebase.auth().currentUser;

    if (!user) return;

    firebase.database().ref('notlar/' + user.uid + '/not').once('value')
    .then(snapshot => {
        const data = snapshot.val();
        if (data && data.metin) {
            document.getElementById("notMetni").value = data.metin;
        } else {
            document.getElementById("notMetni").value = '';
        }
    }).catch(error => {
        console.error("Not getirilemedi:", error);
    });
}


// Not Ekle butonu a√ß
document.getElementById("notEkleBtn").addEventListener("click", () => {
    document.getElementById("notPopup").style.display = "block";
    document.body.classList.add("popup-acik");
    notGetir(); // üîΩ Bu satƒ±r eklendi: Popup a√ßƒ±lƒ±rken mevcut notu y√ºkle
    document.getElementById("notMetni").focus();
});

// Not kaydetme fonksiyonu (mevcut hali doƒüru, sadece feedback ekleyelim)
function notKaydet() {
    const metin = document.getElementById("notMetni").value.trim();
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    if (metin.length === 0) {
        Swal.fire({
            text: 'L√ºtfen bir not yazƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    firebase.database().ref('notlar/' + user.uid + '/not').set({
        metin: metin,
        tarih: new Date().toISOString()
    }).then(() => {
        Swal.fire({
            icon: 'success',
            title: 'Not kaydedildi!',
            showConfirmButton: false,
            timer: 1500
        });
        popupKapat();
    }).catch((error) => {
        console.error("Not kaydedilemedi:", error);
        Swal.fire({
            icon: 'error',
            title: 'Hata!',
            text: 'Not kaydedilirken bir sorun olu≈ütu',
            confirmButtonText: 'Tamam'
        });
    });
}




 // EmailJS ba≈ülatma (kendi bilgilerinizle deƒüi≈ütirin)
    emailjs.init('VCwxBwdvT-HFnnKZ0'); // EmailJS dashboard > Integration > API Keys

   

   
	
	
	
	// Dropdown a√ß/kapa
document.querySelector('.dropdown-btn').addEventListener('click', function() {
  document.querySelector('.dropdown-content').classList.toggle('show');
});

// Dƒ±≈üarƒ± tƒ±klandƒ±ƒüƒ±nda kapat
window.addEventListener('click', function(e) {
  if (!e.target.matches('.dropdown-btn')) {
    const dropdowns = document.querySelectorAll('.dropdown-content');
    dropdowns.forEach(dropdown => {
      if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
      }
    });
  }
});



function iletisimFormuGoster() {
  Swal.fire({
    title: 'üì¨ Bize Ula≈üƒ±n',
    html:
      '<input id="swal-ad" class="swal2-input" placeholder="Adƒ±nƒ±z">' +
      '<input id="swal-email" class="swal2-input" placeholder="E-posta" type="email">' +
      '<textarea id="swal-mesaj" class="swal2-textarea" placeholder="Mesajƒ±nƒ±z..."></textarea>',
    focusConfirm: false,
    showCancelButton: true,
    confirmButtonText: 'G√∂nder',
    cancelButtonText: 'ƒ∞ptal',
    preConfirm: () => {
      return {
        ad: document.getElementById('swal-ad').value,
        email: document.getElementById('swal-email').value,
        mesaj: document.getElementById('swal-mesaj').value
      }
    }
  }).then((result) => {
    if (result.isConfirmed) {
      // Form g√∂nderim i≈ülemi
      const params = {
        name: result.value.ad,
        email: result.value.email,
        message: result.value.mesaj,
        time: new Date().toLocaleString('tr-TR', { 
          day: 'numeric', 
          month: 'long', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        })
      };

      emailjs.send("service_8ofb079","template_80rg1o1",params)
        .then(() => {
          Swal.fire('Ba≈üarƒ±lƒ±!', 'Mesajƒ±nƒ±z g√∂nderildi', 'success');
        }, (error) => {
          Swal.fire('Hata!', 'Mesaj g√∂nderilemedi: ' + error.text, 'error');
        });
    }
  });
}

// ƒ∞leti≈üim formunu a√ß
// Dropdown men√ºdeki tƒ±klamalarƒ± SweetAlert ile deƒüi≈ütir
document.getElementById('iletisimAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  iletisimFormuGoster();
});



// Ayarlar ve Yardƒ±m i√ßin bo≈ü fonksiyonlar
document.getElementById('ayarlarAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  Swal.fire({
    title: 'Ayarlar',
    text: 'Ayarlar paneli yakƒ±nda eklenecek',
    icon: 'info'
  });
});

document.getElementById('yardimAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  Swal.fire({
    title: 'Yardƒ±m',
    text: 'ƒ∞leti≈üim b√∂l√ºm√ºnden bize ula≈üƒ±n',
    icon: 'question'
  });
});

// Google Auth ba≈ülatƒ±cƒ±
let googleAuthInstance;

function initGoogleAuth() {
  try {
    gapi.load('auth2', () => {
      gapi.auth2.init({
        client_id: '344034966705-8paqve5db6002isrh7ahjk6s2e1ps4ob.apps.googleusercontent.com',
        scope: 'https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.file'
      }).then(auth => {
        googleAuthInstance = auth;
      }).catch(err => {
        console.error("Google Auth ba≈ülatƒ±lamadƒ±:", err);
      });
    });
  } catch (e) {
    console.error("Google API y√ºklenemedi:", e);
  }
}
function signInGoogle(callback) {
  if (!googleAuthInstance) {
    Swal.fire('Hata', 'Google API hen√ºz hazƒ±r deƒüil. L√ºtfen sayfayƒ± yenileyin veya biraz bekleyin.', 'error');
    return;
  }

  if (googleAuthInstance.isSignedIn.get()) {
    callback();
  } else {
    googleAuthInstance.signIn().then(callback).catch(err => {
      Swal.fire('Hata', 'Google ile giri≈ü yapƒ±lamadƒ±.', 'error');
      console.error(err);
    });
  }
}

function yedekleDrive() {
  const user = firebase.auth().currentUser;
  if (!user) return Swal.fire('Giri≈ü gerekli', 'L√ºtfen √∂nce uygulamaya giri≈ü yapƒ±n.', 'warning');

  signInGoogle(() => {
    Swal.fire({
      title: 'Yedekleniyor...',
      text: 'Verileriniz Google Drive\'a y√ºkleniyor, l√ºtfen bekleyin.',
      allowOutsideClick: false,
      didOpen: () => { Swal.showLoading(); }
    });

    const kayitlarRef = firebase.database().ref('kayitlar/' + user.uid);
    const notlarRef = firebase.database().ref('notlar/' + user.uid);

    Promise.all([
      kayitlarRef.once('value'),
      notlarRef.once('value')
    ]).then(snapshots => {
      const backupData = {
        kayitlar: snapshots[0].val() || {},
        notlar: snapshots[1].val() || {}
      };

      const jsonBlob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
      const fileName = `NotUygulamasi_Yedek_${new Date().toISOString().split('T')[0]}.json`;

      const metadata = {
        'name': fileName,
        'mimeType': 'application/json',
        'parents': ['appDataFolder']
      };

      const form = new FormData();
      form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
      form.append('file', jsonBlob);

      const accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;

      fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
        method: 'POST',
        headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
        body: form
      }).then(res => {
        if (res.ok) return res.json();
        throw new Error('Y√ºkleme ba≈üarƒ±sƒ±z.');
      }).then(() => {
        Swal.fire('Ba≈üarƒ±lƒ±', 'Yedek ba≈üarƒ±yla Google Drive‚Äôa y√ºklendi.', 'success');
      }).catch(error => {
        Swal.fire('Hata', 'Yedekleme sƒ±rasƒ±nda bir sorun olu≈ütu.', 'error');
        console.error(error);
      });
    });
  });
}

function driveYedektenYukle() {
  const user = firebase.auth().currentUser;
  if (!user) return Swal.fire('Giri≈ü gerekli', 'L√ºtfen √∂nce uygulamaya giri≈ü yapƒ±n.', 'warning');

  signInGoogle(() => {
    Swal.fire({
      title: 'Yedek Aranƒ±yor...',
      text: 'Google Drive\'daki en son yedeƒüiniz aranƒ±yor.',
      allowOutsideClick: false,
      didOpen: () => { Swal.showLoading(); }
    });

    const accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;

    gapi.client.load('drive', 'v3', () => {
      gapi.client.drive.files.list({
        'q': 'name contains "NotUygulamasi_Yedek"',
        'spaces': 'appDataFolder',
        'fields': 'files(id, name)',
        'orderBy': 'createdTime desc',
        'pageSize': 1
      }).then(res => {
        const files = res.result.files;
        if (!files || files.length === 0) {
          return Swal.fire('Bulunamadƒ±', 'Google Drive\'da uygulama yedeƒüi bulunamadƒ±.', 'info');
        }

        const fileId = files[0].id;

        Swal.update({
          title: 'Yedek ƒ∞ndiriliyor...',
          text: 'Yedek dosyasƒ± indiriliyor ve verileriniz g√ºncellenecek.'
        });

        return gapi.client.drive.files.get({
          fileId: fileId,
          alt: 'media'
        });

      }).then(res => {
        if (!res) return;
        const backupData = res.result;
        Swal.fire({
          title: 'Emin misiniz?',
          text: "Mevcut verileriniz silinecek ve yedekten gelen verilerle deƒüi≈ütirilecek!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Evet, geri y√ºkle!',
          cancelButtonText: 'ƒ∞ptal'
        }).then((result) => {
          if (result.isConfirmed) {
            const kayitlarRef = firebase.database().ref('kayitlar/' + user.uid);
            const notlarRef = firebase.database().ref('notlar/' + user.uid);

            Promise.all([
              kayitlarRef.set(backupData.kayitlar || {}),
              notlarRef.set(backupData.notlar || {})
            ]).then(() => {
              Swal.fire('Ba≈üarƒ±lƒ±!', 'Verileriniz yedekten ba≈üarƒ±yla geri y√ºklendi.', 'success');
            }).catch(err => {
              Swal.fire('Hata', 'Veriler geri y√ºklenirken bir sorun olu≈ütu.', 'error');
              console.error(err);
            });
          }
        });

      }).catch(err => {
        console.error("Drive'dan y√ºkleme hatasƒ±:", err);
        Swal.fire('Hata', 'Yedek geri y√ºklenirken bir sorun olu≈ütu.', 'error');
      });
    });
  });
}
 function handleClientLoad() {
    initGoogleAuth(); // senin kullandƒ±ƒüƒ±n fonksiyonla aynƒ± i≈üi yapsƒ±n
  }


</script>

   </body>
</html>
