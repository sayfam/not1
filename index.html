<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


	<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://accounts.google.com https://cdn.jsdelivr.net https://www.gstatic.com https://www.googleapis.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net;
  img-src 'self' data:;
  connect-src 'self' https://www.googleapis.com https://accounts.google.com https://securetoken.googleapis.com https://firestore.googleapis.com wss://*.firebaseio.com;
  frame-src 'self' https://accounts.google.com https://drive.google.com;
  font-src 'self' https://fonts.gstatic.com;
  object-src 'none';
">

	<script>
  function loadGoogleApi() {
    const script = document.createElement("script");
	
    script.src = "https://apis.google.com/js/api.js";
    script.onload = initGoogleAuth;
    document.head.appendChild(script);
  }

  window.onload = loadGoogleApi;
</script>




  	<title>Note's</title>
	<link rel="icon" href="lock.png" type="image/png" />
	
    <style>
        body {
            background-color: #1e1e2f;
            color: #ffffff;
            font-family: "Courier New", Courier, monospace;
            max-width: 600px;
            margin: 0 auto;
            padding: 0px 15px;
        }

        h2, h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        input, button {
            font-family: "Courier New", Courier, monospace;
            font-size: 16px;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            border-radius: 5px;
        }

        input {
            background-color: #2a2a40;
            color: #fff;
            border: 1px solid #444;
        }

        button {
            background-color: #03a9f4;
            color: white;
            transition: background 0.3s ease;
        }

        button:hover {
            background-color: #0288d1;
        }

        #guncelleBtn {
            background-color: #8bc34a;
        }

        #guncelleBtn:hover {
            background-color: #689f38;
        }

        #kayitListesi {
            margin-top: 30px;
            border-top: 1px solid #555;
            padding-top: 15px;
        } 
		#kayitListesi  button{
            margin-top: 10px;
            border-top: 1px solid #555;
        
		
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

.listeSatiri {
position: relative; /* Ã‡ocuk elementlerin (kayitZamani) konumlandÄ±rÄ±lmasÄ± iÃ§in */
    background-color: #2a2a40;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
	 padding-top: 30px; /* Zaman alanÄ± iÃ§in yukarÄ±dan boÅŸluk bÄ±rakÄ±n */
}
.kayitZamani {
    position: absolute; /* .listeSatiri'ye gÃ¶re konumlandÄ±rma */
    top: 5px; /* Ãœstten biraz boÅŸluk */
    left: 50%; /* Yatayda ortaya */
    transform: translateX(-50%); /* Kendi geniÅŸliÄŸinin yarÄ±sÄ± kadar sola kaydÄ±rarak tam ortaya */
    font-size: 11px; /* Daha kÃ¼Ã§Ã¼k font */
    color: #bbb; /* Biraz daha soluk renk */
    background-color: #3a3a5a; /* Hafif bir arka plan */
    padding: 2px 8px;
    border-radius: 3px;
    white-space: nowrap; /* Metnin tek satÄ±rda kalmasÄ±nÄ± saÄŸlar */
    box-shadow: 0 1px 3px rgba(0,0,0,0.2); /* Hafif gÃ¶lge */
    z-index: 1; /* DiÄŸer iÃ§eriklerin Ã¼zerinde gÃ¶rÃ¼nmesini saÄŸlar */
}

.listeSatiri span {
    flex-grow: 1;
    word-break: break-word;
}

.listeSatiri .butonGrubu {
flex-direction: column;
    display: flex;
    gap: 6px;
}

.listeSatiri button {
    font-size: 13px;
    padding: 6px 10px;
    border-radius: 4px;
    border: none;
    width: 80px;
    cursor: pointer;
}

.listeSatiri .duzenleBtn {
    background-color: #f57c00;
    color: white;
}

.listeSatiri .duzenleBtn:hover {
    background-color: #ef6c00;
}

.listeSatiri .silBtn {
    background-color: #e53935;
    color: white;
}

.listeSatiri .silBtn:hover {
    background-color: #c62828;
}

.logoutBtn {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 10px 20px;
  
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
    float: right;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.logoutBtn:hover {
    background-color: #7b1fa2;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}





    #notPopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffffff;
      color: #000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      z-index: 999;
      width: 90%;
      max-width: 500px;
    }

    #notMetni {
      width: 90%;
      height: 200px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }

    .popup-buttons {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
    }

    .popup-buttons button {
      padding: 10px 20px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .saveBtn {
      background-color: #27ae60;
      color: white;
    }

    .cancelBtn {
      background-color: #e74c3c;
      color: white;
    }

    body.popup-acik::before {
      content: "";
      position: fixed;
      top: 0; left: 0; bottom: 0; right: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: 998;
    }

.uc-lu {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.aramaKutusu {
flex: 1; /* TÃ¼m boÅŸluÄŸu kaplasÄ±n */
    position: relative;
}
#kelimeBul {
  flex: 1 1 80%;
  padding: 8px;
  font-size: 16px;
}
.temizleBtn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 14px;
  color: #999;
  display: none;
}
#notEkleBtn {
  flex: 0 0 10%;
  padding: 8px;
  font-size: 16px;
  cursor: pointer;
}

.logoutBtn {
  flex: 0 0 10%;
  padding: 8px;
  font-size: 16px;
  cursor: pointer;
}
#notEkleBtn:hover {
    background-color: #7b1fa2;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

#notBaslik {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    font-weight: bold;
}

.temizleBtn  {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 14px;
  color: #999;
  display: none; /* BaÅŸlangÄ±Ã§ta gizli */
}



.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  position: relative;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-btn {
  background-color: #4a6fa5;
  color: white;
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-family: "Courier New", Courier, monospace;
  transition: all 0.3s;
}

.dropdown-btn:hover {
  background-color: #3a5a80;
}

.dropdown-content {
  display: none;
  position: absolute;
  right: 0;
  background-color: #2a2a40;
  min-width: 160px;
  box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 5px;
  border: 1px solid #444;
}

.dropdown-content a {
  color: #fff;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 14px;
}

.dropdown-content a:hover {
  background-color: #3a3a5a;
}

.show { display: block; }


/* SweetAlert Ã¶zelleÅŸtirmeleri */
.swal2-popup {
  background: #2a2a40 !important;
  color: #fff !important;
}

.swal2-input, .swal2-textarea {
  background: #1e1e2f !important;
  color: #fff !important;
  border: 1px solid #444 !important;
}

.swal2-textarea {
  height: 100px;
  resize: vertical;
}
/* Password gÃ¶ster/gizle ikonlarÄ± iÃ§in */
.password-container {
    position: relative;
    width: 100%; /* Input ile aynÄ± geniÅŸlikte olmasÄ± iÃ§in */
    margin: 8px 0; /* Input ile aynÄ± margin */
}

.password-container input {
    width: 100%;
    padding-right: 40px; /* GÃ¶z ikonu iÃ§in saÄŸdan boÅŸluk */
    /* Input'un diÄŸer mevcut stilleri */
}

.toggle-password {
    position: absolute;
    right: 10px; /* SaÄŸdan boÅŸluk */
    top: 50%; /* Dikeyde ortaya */
    transform: translateY(-50%); /* Kendi yÃ¼ksekliÄŸinin yarÄ±sÄ± kadar yukarÄ± kaydÄ±rarak tam ortaya */
    cursor: pointer;
    color: #999; /* Ä°kon rengi */
    font-size: 20px; /* Ä°kon boyutu */
    user-select: none; /* Metin seÃ§imi engeller */
}

.toggle-password:hover {
    color: #fff; /* Ãœzerine gelince beyaz */
}



/* FOOTER STÄ°LLERÄ° */
/* FOOTER STÄ°LLERÄ° - Temaya Uygun Koyu Renkler */
.app-footer {
    text-align: center;
    padding: 10px 0; /* Ãœstten ve alttan daha az boÅŸluk */
    background-color: ##080011; /* Koyu mor tonu - Tema rengine daha yakÄ±n */
    color: #e0e0e0; /* Metin rengi aÃ§Ä±k olsun */
    border-top: 1px solid #550099; /* Daha belirgin ama uyumlu bir kenarlÄ±k */
    font-size: 0.85em; /* Metin boyutunu biraz kÃ¼Ã§Ã¼ltme */
    width: 100%;
    box-sizing: border-box;
    margin-top: auto; /* Ä°Ã§eriÄŸin az olduÄŸu durumlarda footer'Ä± alta iter */
    position: relative; /* Z-index iÃ§in */
    z-index: 10; /* DiÄŸer Ã¶ÄŸelerin altÄ±nda kalmamasÄ± iÃ§in */
}

.app-footer .footer-content {
    max-width: 1200px; /* GeniÅŸliÄŸi artÄ±rÄ±n veya temanÄ±za gÃ¶re ayarlayÄ±n */
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.app-footer p {
    margin: 3px 0; /* Paragraflar arasÄ± boÅŸluÄŸu azaltma */
}

.app-footer .footer-links a {
    text-decoration: none;
    color: #99ccff; /* BaÄŸlantÄ± rengi - Koyu zeminde okunabilir aÃ§Ä±k mavi */
    margin: 0 8px;
    transition: color 0.3s ease;
}

.app-footer .footer-links a:hover {
    color: #cceeff; /* Fare Ã¼zerine gelindiÄŸinde daha aÃ§Ä±k bir renk */
}

/* GÄ°RÄ°Å EKRANI AKTÄ°FKEN FOOTER'I GÄ°ZLE */
body.login-active .app-footer {
    display: none;
}
    </style>
</head>
<body>

<div id="loginSection">
    <h2>GiriÅŸ Yap</h2>
    <input type="email" id="emailInput" placeholder="Email">
	<div class="password-container">
    <input type="password" id="passwordInput" placeholder="Åifre">
	<span class="toggle-password" onclick="togglePasswordVisibility('passwordInput', this)">ğŸµ</span>
	</div>
    <button onclick="login()">GiriÅŸ Yap</button>
    
    <p style="text-align: center; margin-top: 15px; margin-bottom: 5px; font-size: 15px;">
        HesabÄ±nÄ±z yok mu? 
        <a href="javascript:void(0);" onclick="showSignup()"
           style="color: #03a9f4; text-decoration: none; transition: color 0.3s ease, text-decoration 0.3s ease;">
           KayÄ±t ol
        </a>
    </p>
    
    <p style="text-align: center; margin-top: 5px; margin-bottom: 20px; font-size: 15px;">
        <a href="javascript:void(0);" onclick="resetPassword()"
           style="color: #03a9f4; text-decoration: none; transition: color 0.3s ease, text-decoration 0.3s ease;">
           Åifremi Unuttum
        </a>
    </p>
</div>

<div id="signupSection" style="display:none;">
    <h2>KayÄ±t Ol</h2>
    <input type="email" id="signupEmail" placeholder="Email">
	<div class="password-container">
    <input type="password" id="signupPassword" placeholder="Åifre">
	<span class="toggle-password" onclick="togglePasswordVisibility('signupPassword', this)">ğŸµï¸</span>
	</div>
    <button onclick="signup()">KayÄ±t Ol</button>
    
    <p style="text-align: center; margin-top: 15px; margin-bottom: 20px; font-size: 15px;">
        HesabÄ±nÄ±z var mÄ±? 
        <a href="javascript:void(0);" onclick="showLogin()"
           style="color: #03a9f4; text-decoration: none; transition: color 0.3s ease, text-decoration 0.3s ease;">
           GiriÅŸ yap
        </a>
    </p>
    
    <p id="signupMessage" style="color: #8bc34a; display: none;">KayÄ±t oluÅŸturuldu, giriÅŸ yapÄ±n.</p>
</div>






  <!-- Ä°Ã§erik BÃ¶lÃ¼mÃ¼ -->
  
<div id="kayitListesi" style="display:none;">
<p id="hosgeldinYazi" style="text-align:center; margin-top: 10px; font-weight: bold;"></p>


  <h5 id="notBaslik">Note's</h5>







<div class="uc-lu">
    <button class="logoutBtn" onclick="logout()" title="Ã‡Ä±kÄ±ÅŸ">ğŸ”“</button>
   <div class="aramaKutusu">
    <input type="text" id="kelimeBul" placeholder="Ara">
   <span class="temizleBtn" onclick="temizleInput()">âŒ</span>
</div>
  <button id="notEkleBtn" title="Not Ekleyin...">ğŸ“</button>
  
<div class="dropdown">
        <button class="dropdown-btn">â˜° MenÃ¼</button>
     <div class="dropdown-content">
    <a href="#" id="iletisimAc">ğŸ“© Ä°letiÅŸim</a>
    <a href="#" id="ayarlarAc">âš™ï¸ Ayarlar</a>
    <a href="#" id="yardimAc">â“ YardÄ±m</a>


</div>
    </div>
	
</div>


  <!-- Not Popup Kutusu -->
  <div id="notPopup">
    <h3 style="margin-top: 0;">NotlarÄ±m</h3>
    <textarea id="notMetni" placeholder="NotlarÄ±nÄ±zÄ± buraya yazÄ±n..."></textarea>
    <div  class="popup-buttons">
      <button  class="saveBtn" onclick="notKaydet()">Kaydet</button>
      <button class="cancelBtn" onclick="popupKapat()">Ä°ptal</button>
    </div>
  </div>




<div style="text-align:center; margin: 24px 0; color: #aaa;">âœ§ âœ¦ âœ§</div>



    <!-- 3 adet input alanÄ± -->
	<div class="content-inbtn" >
    <input  type="text" id="isimInput" placeholder="Bilgi Giriniz...">
    <input  type="text" id="soyadInput" placeholder="Bilgi Giriniz...">
    <input  type="text" id="telefonInput" placeholder="Bilgi Giriniz...">

    <button  id="kaydetBtn" onclick="isimKaydet()">â• Kaydet</button>
    <button  id="guncelleBtn" onclick="isimGuncelle()" style="display:none;">âœ” GÃ¼ncelle</button>
    <button  id="vazgecBtn" style="display: none;">âœ– VazgeÃ§</button>
</div>

    <h3>	âœï¸ Size Ait Notlar</h3>
    <ul id="isimlerListesi"></ul>
</div>



	   

    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>



<script src="https://apis.google.com/js/api.js" async defer></script>

   <script>
   
   
   
    // Firebase konfigÃ¼rasyonu
        const firebaseConfig = {
            apiKey: "AIzaSyBWj53RpZd_xcWGD-ZLIyXBYz8H9MehM7Y",
            authDomain: "dosya01-7a585.firebaseapp.com",
            databaseURL: "https://dosya01-7a585-default-rtdb.firebaseio.com",
            projectId: "dosya01-7a585",
            storageBucket: "dosya01-7a585.firebasestorage.app",
            messagingSenderId: "502419176600",
            appId: "1:502419176600:web:d4304f2a0bfc30d03ce4ed"
        };
        firebase.initializeApp(firebaseConfig);

        let currentEditKey = null;
		
		  // oturum zamanlayÄ±cÄ±sÄ± start
		let sessionTimeout = null;

function baslatOturumZamani() {
   
	
	  // Mevcut zamanlayÄ±cÄ± varsa temizle
    if (sessionTimeout) {
        clearTimeout(sessionTimeout);
        sessionTimeout = null; // ZAMANLAYICIYI BURADA NULL YAPARAK RESETLE
    }
	
	
    sessionTimeout = setTimeout(() => {
        firebase.auth().signOut().then(() => {
            Swal.fire({
                icon: 'info',
                title: 'Oturum SÃ¼resi Doldu',
                text: 'LÃ¼tfen tekrar giriÅŸ yapÄ±n.',
                confirmButtonText: 'Tamam'
            }).then(() => {
                document.getElementById('loginSection').style.display = "block";
                document.getElementById('kayitListesi').style.display = "none";
                document.getElementById('signupSection').style.display = "none";
                document.getElementById('emailInput').value = "";
                document.getElementById('passwordInput').value = "";
				
				 // *** BURAYA EKLEYECEÄÄ°Z ***
                // loginSection gÃ¶sterildiÄŸinde altbilgiyi gizle
                toggleLoginScreen(true); // Altbilgiyi gizle
            });
        });
    }, 30000); // 30 saniye
}

// oturum zamanlayÄ±cÄ±sÄ± finish


// KayÄ±t Olma Fonksiyonu
        function signup() {
            const email = document.getElementById('signupEmail').value.trim(); // .trim() ekledim
            const password = document.getElementById('signupPassword').value.trim(); // .trim() ekledim

            // BoÅŸ alan kontrolÃ¼
            if (!email) {
                Swal.fire({
                    icon: 'error',
                    title: 'KayÄ±t HatasÄ±',
                    text: 'LÃ¼tfen e-posta adresinizi girin!'
                });
                return;
            }
            if (!password) {
                Swal.fire({
                    icon: 'error',
                    title: 'KayÄ±t HatasÄ±',
                    text: 'LÃ¼tfen bir ÅŸifre belirleyin!'
                });
                return;
            }
            if (password.length < 6) { // Firebase varsayÄ±lan ÅŸifre uzunluÄŸu gereksinimi
                Swal.fire({
                    icon: 'error',
                    title: 'KayÄ±t HatasÄ±',
                    text: 'Åifreniz en az 6 karakter olmalÄ±dÄ±r.'
                });
                return;
            }


            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("KayÄ±t baÅŸarÄ±lÄ±: ", user.uid);
                  
                    // E-posta doÄŸrulama baÄŸlantÄ±sÄ±nÄ± gÃ¶nder
                    user.sendEmailVerification().then(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'KayÄ±t BaÅŸarÄ±lÄ±!',
                            html: 'HesabÄ±nÄ±z oluÅŸturuldu. LÃ¼tfen giriÅŸ yapmadan Ã¶nce <strong>e-posta adresinize gÃ¶nderilen doÄŸrulama baÄŸlantÄ±sÄ±na tÄ±klayÄ±n.</strong>',
                            confirmButtonText: 'Tamam'
                        }).then(() => {
                            showLogin(); // KullanÄ±cÄ±ya giriÅŸ ekranÄ±nÄ± gÃ¶ster
                        });
                    }).catch((error) => {
                        console.error("E-posta doÄŸrulama gÃ¶nderilemedi:", error);
                        Swal.fire({
                            icon: 'error',
                            title: 'KayÄ±t BaÅŸarÄ±lÄ± (DoÄŸrulama HatasÄ±)',
                            text: 'HesabÄ±nÄ±z oluÅŸturuldu ancak doÄŸrulama e-postasÄ± gÃ¶nderilemedi. LÃ¼tfen daha sonra tekrar deneyin veya bizimle iletiÅŸime geÃ§in.'
                        }).then(() => {
                            showLogin();
                        });
                    });
                })
                .catch((error) => {
                    // Hata nesnesini konsola yazdÄ±rarak detaylarÄ± gÃ¶rÃ¼n
                    console.error("Firebase KayÄ±t HatasÄ± Objesi:", error); 

                    let errorMessage = "Bilinmeyen bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin."; // VarsayÄ±lan hata mesajÄ±

                    if (error.code) { // Firebase hata kodu varsa
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage = 'Bu e-posta adresi zaten kullanÄ±mda.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'GeÃ§ersiz e-posta adresi. LÃ¼tfen doÄŸru bir e-posta formatÄ± girin.';
                                break;
                            case 'auth/operation-not-allowed':
                                errorMessage = 'E-posta/Åifre ile giriÅŸ devre dÄ±ÅŸÄ±. LÃ¼tfen Firebase kimlik doÄŸrulama ayarlarÄ±nÄ±zÄ± kontrol edin.';
                                break;
                            case 'auth/weak-password':
                                errorMessage = 'Åifre Ã§ok zayÄ±f. LÃ¼tfen en az 6 karakterli gÃ¼Ã§lÃ¼ bir ÅŸifre belirleyin.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                                break;
                            default:
                                errorMessage = `KayÄ±t olurken bir hata oluÅŸtu: ${error.message}`;
                                break;
                        }
                    } else if (error.message) {
                        // EÄŸer error.code yoksa ama error.message varsa
                        errorMessage = `KayÄ±t olurken bir hata oluÅŸtu: ${error.message}`;
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'KayÄ±t HatasÄ±',
                        text: errorMessage
                    });
                });
        }

       
       // GiriÅŸ Yapma Fonksiyonu
        function login() {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            kullaniciSifresi = password;

   
	
            // BoÅŸ alan kontrolÃ¼
            if (!email) {
                Swal.fire({
                    icon: 'error',
                    title: 'GiriÅŸ HatasÄ±',
                    text: 'LÃ¼tfen e-posta adresinizi girin!'
                });
                return;
            }
            if (!password) {
                Swal.fire({
                    icon: 'error',
                    title: 'GiriÅŸ HatasÄ±',
                    text: 'LÃ¼tfen ÅŸifrenizi girin!'
                });
                return;
            }

              firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("GiriÅŸ baÅŸarÄ±lÄ±: ", user.uid);

                    // E-posta adresinin doÄŸrulanÄ±p doÄŸrulanmadÄ±ÄŸÄ±nÄ± kontrol et
                    if (user.emailVerified) {
                        showContent(user.uid);
                        document.getElementById('hosgeldinYazi').textContent = `HoÅŸ geldiniz, ${user.email}`;
                        baslatOturumZamani();
                        document.getElementById('loginSection').style.display = "none";
                        document.getElementById('signupSection').style.display = "none";
                    } else {
                        // E-posta doÄŸrulanmamÄ±ÅŸsa kullanÄ±cÄ±yÄ± uyar ve Ã§Ä±kÄ±ÅŸ yap
                        firebase.auth().signOut().then(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'GiriÅŸ BaÅŸarÄ±sÄ±z',
                                html: 'E-posta adresiniz doÄŸrulanmamÄ±ÅŸ. LÃ¼tfen giriÅŸ yapmadan Ã¶nce <strong>e-postanÄ±za gÃ¶nderilen doÄŸrulama baÄŸlantÄ±sÄ±na tÄ±klayÄ±n.</strong> <br><br> DoÄŸrulama e-postasÄ± almadÄ±ysanÄ±z, tekrar gÃ¶ndermek iÃ§in bizimle iletiÅŸime geÃ§in.',
                                confirmButtonText: 'Tamam'
                            });
                        });
                    }
                })
                .catch((error) => {
                    // Hata nesnesini konsola yazdÄ±rarak detaylarÄ± gÃ¶rÃ¼n
                    console.error("Firebase GiriÅŸ HatasÄ± Objesi:", error); 

                    let errorMessage = "Bilinmeyen bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin."; // VarsayÄ±lan hata mesajÄ±

                    if (error.code) { // Firebase hata kodu varsa
                        switch (error.code) {
                            case 'auth/invalid-email':
                                errorMessage = 'GeÃ§ersiz e-posta adresi. LÃ¼tfen doÄŸru bir e-posta formatÄ± girin.';
                                break;
                            case 'auth/user-disabled':
                                errorMessage = 'Bu hesap devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ.';
                                break;
                            case 'auth/user-not-found':
                            case 'auth/wrong-password': // Bu iki hata genellikle birleÅŸir veya birbiri yerine kullanÄ±lÄ±r
                            case 'auth/invalid-credential': // Modern Firebase SDK bu kodu kullanabilir
                                errorMessage = 'E-posta veya ÅŸifre yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                                break;
                            default:
                                errorMessage = `GiriÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu: ${error.message}`;
                                break;
                        }
                    } 
                    
                    // error.code ile yakalanamayan durumlar iÃ§in error.message iÃ§eriÄŸini kontrol edelim
                    // Hata mesajÄ± JSON formatÄ±nda olabileceÄŸinden, JSON'Ä± ayrÄ±ÅŸtÄ±rmaya Ã§alÄ±ÅŸalÄ±m
                    try {
                        const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{'))); // Hata mesajÄ±nÄ±n JSON kÄ±smÄ±nÄ± ayÄ±r
                        if (parsedMessage.error && parsedMessage.error.message === "INVALID_LOGIN_CREDENTIALS") {
                            errorMessage = 'E-posta veya ÅŸifre yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                        }
                    } catch (e) {
                        // EÄŸer error.message JSON deÄŸilse veya farklÄ± bir formattaysa,
                        // sadece includes() ile kontrol etmeye devam edebiliriz.
                        if (error.message && error.message.includes("INVALID_LOGIN_CREDENTIALS")) {
                            errorMessage = 'E-posta veya ÅŸifre yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                        } else if (error.message) {
                            // Genel bir hata mesajÄ±
                            errorMessage = `GiriÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu: ${error.message}`;
                        }
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'GiriÅŸ HatasÄ±',
                        text: errorMessage
                    });
                });
        }
	

    // KayÄ±t Olma Fonksiyonu
  function isimKaydet() {
    const user = firebase.auth().currentUser;
    if (!user) {
        Swal.fire({
            text: 'LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    const ad = document.getElementById('isimInput').value.trim();
    const soyad = document.getElementById('soyadInput').value.trim();
    const telefon = document.getElementById('telefonInput').value.trim();

    if (ad === "" && soyad === "" && telefon === "") {
        Swal.fire({
            text: 'LÃ¼tfen en az bir alanÄ± doldurun!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    // KullanÄ±cÄ± UID'si ile kayÄ±t yapÄ±ldÄ±ÄŸÄ±ndan emin olun
    firebase.database().ref('kayitlar/' + user.uid).push({
        ad: ad,
        soyad: soyad,
        telefon: telefon,
        tarih: new Date().toISOString()
    }).then(() => {
        document.getElementById('isimInput').value = "";
        document.getElementById('soyadInput').value = "";
        document.getElementById('telefonInput').value = "";
    }).catch(error => {
        console.error("KayÄ±t hatasÄ±:", error);
    });
}

// KullanÄ±cÄ±nÄ±n kendi verilerini gÃ¶rÃ¼ntÃ¼leme
// KullanÄ±cÄ±nÄ±n kendi verilerini gÃ¶rÃ¼ntÃ¼leme
function showContent(uid) {
    // Ã–nce mevcut dinleyiciyi kaldÄ±r (Ã¶nemli!)
    firebase.database().ref('kayitlar/' + uid).off();

    // Yeni dinleyici ekle
    firebase.database().ref('kayitlar/' + uid).on('value', (snapshot) => {
        const isimler = snapshot.val();
        const isimlerListesi = document.getElementById('isimlerListesi');
        isimlerListesi.innerHTML = ""; // Listeyi temizle

        console.log("Firebase'den gelen isimler:", isimler);

        function linkeDonustur(metin) {
            if (!metin) return '';
            const regex = /^\*\*(.*?)\*\*$/;
            const match = metin.match(regex);
            if (match) {
                let hedef = match[1].trim();
                const urlRegex = /^(https?:\/\/|www\.)[^\s]+$/i;
                if (urlRegex.test(hedef)) {
                    if (hedef.startsWith('www.')) {
                        hedef = 'https://' + hedef;
                    }
                    return `<a href="${hedef}" target="_blank" style="color:white; text-decoration: underline; text-decoration-color:#03a9f4; font-weight:bold;">${match[1]}</a>`;
                } else {
                    return match[1];
                }
            }
            return metin;
        }

        if (isimler) {
            // **BURADA SÄ°RULAMA MANTIÄI DEÄÄ°ÅTÄ°**
            const kayitlarDizisi = [];
            for (const key in isimler) {
                if (isimler.hasOwnProperty(key)) {
                    kayitlarDizisi.push({
                        key: key,
                        ...isimler[key] // TÃ¼m kayÄ±t verilerini al
                    });
                }
            }

            // `tarih` alanÄ±na gÃ¶re azalan sÄ±rada sÄ±rala (en yeni en baÅŸta)
            kayitlarDizisi.sort((a, b) => {
                // Tarihler string olarak ISO formatÄ±nda ise doÄŸrudan karÅŸÄ±laÅŸtÄ±rÄ±labilir
                // EÄŸer tarih yoksa (eski kayÄ±tlar iÃ§in), bunlarÄ± listenin sonuna atabiliriz.
                const dateA = a.tarih ? new Date(a.tarih).getTime() : 0;
                const dateB = b.tarih ? new Date(b.tarih).getTime() : 0;
                return dateB - dateA; // Azalan sÄ±ra (en yeni en baÅŸta)
            });

            // SÄ±ralanmÄ±ÅŸ dizi Ã¼zerinde dÃ¶ngÃ¼ yap ve listeye ekle
            for (const kayitObj of kayitlarDizisi) {
                const key = kayitObj.key;
                const kayit = kayitObj; // Zaten kayÄ±t objesinin kendisi

                const li = document.createElement('li');
                li.classList.add('listeSatiri');
                li.id = key; // KaydÄ±rma iÃ§in ID atamasÄ± hala Ã¶nemli!

              // BURADA DEÄÄ°ÅÄ°KLÄ°K YAPILIYOR: kayitZamani div'i eklendi
                li.innerHTML = `
                    <div class="kayitZamani">${new Date(kayit.tarih).toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
                    <div>
                        <span>${linkeDonustur(kayit.ad)}</span><br>
                        <span>${linkeDonustur(kayit.soyad)}</span><br>
                        <span>${linkeDonustur(kayit.telefon)}</span>
                    </div>
                    <div class="butonGrubu">
                        <button class="duzenleBtn" onclick="guncelle('${key}', '${kayit.ad || ''}', '${kayit.soyad || ''}', '${kayit.telefon || ''}')">DÃ¼zenle</button>
                        <button class="silBtn" onclick="sil('${key}')">Sil</button>
                    </div>
                `;
                isimlerListesi.appendChild(li); // appendChild kullanÄ±yoruz Ã§Ã¼nkÃ¼ zaten sÄ±ralanmÄ±ÅŸ dizi Ã¼zerinde dÃ¶nÃ¼yoruz
            }
            // **SÄ°RULAMA MANTIÄI BÄ°TTÄ°**
        }
        document.getElementById('kayitListesi').style.display = "block";
        document.getElementById("kelimeBul").focus();
    });
}
   

    // Veriyi silme
  function sil(key) {
    const user = firebase.auth().currentUser;

    Swal.fire({
        title: 'Emin misiniz?',
        text: "Bu kaydÄ± silmek Ã¼zeresiniz!",
      
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Evet, sil!',
        cancelButtonText: 'Ä°ptal'
    }).then((result) => {
        if (result.isConfirmed) {
            firebase.database().ref('kayitlar/' + user.uid + '/' + key).remove()
                .then(() => {
                    Swal.fire(
                        'Silindi!',
                        'KayÄ±t baÅŸarÄ±yla silindi.',
                        'success'
                    );
                })
                .catch((error) => {
                    Swal.fire(
                        'Hata!',
                        'KayÄ±t silinirken bir sorun oluÅŸtu.',
                        'error'
                    );
                    console.error(error);
                });
        }
    });
}



// Veriyi gÃ¼ncelleme (DÃ¼zenle butonu tÄ±klandÄ±ÄŸÄ±nda)
function guncelle(key, ad, soyad, telefon) {
    currentEditKey = key;
    document.getElementById('isimInput').value = ad;
    document.getElementById('soyadInput').value = soyad;
    document.getElementById('telefonInput').value = telefon;
    document.getElementById('guncelleBtn').style.display = "block";
    document.getElementById('vazgecBtn').style.display = "inline-block";
    document.getElementById('kaydetBtn').style.display = "none"; // KAYDET butonunu gizle
    document.getElementById('guncelleBtn').onclick = () => {
        isimGuncelle(key);
    };

    // SayfayÄ± input alanlarÄ±nÄ±n olduÄŸu yere kaydÄ±r
    document.getElementById('isimInput').scrollIntoView({ behavior: 'smooth', block: 'start' });
}


// Veriyi gÃ¼ncelleme
function isimGuncelle(key) {
    const user = firebase.auth().currentUser;
    const yeniAd = document.getElementById('isimInput').value.trim();
    const yeniSoyad = document.getElementById('soyadInput').value.trim();
    const yeniTelefon = document.getElementById('telefonInput').value.trim();

    if (yeniAd === "" && yeniSoyad === "" && yeniTelefon === "") {
        Swal.fire({
            text: 'LÃ¼tfen en az bir alanÄ± doldurun!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    // BURADA DEÄÄ°ÅÄ°KLÄ°K YAPILDI: `tarih` alanÄ±nÄ± da gÃ¼ncelliyoruz
    firebase.database().ref('kayitlar/' + user.uid + '/' + key).update({
        ad: yeniAd,
        soyad: yeniSoyad,
        telefon: yeniTelefon,
        tarih: new Date().toISOString() // GÃ¼ncelleme anÄ±ndaki yeni tarih
    }).then(() => {
        // Formu ve butonlarÄ± temizle/resetle
        document.getElementById('guncelleBtn').style.display = "none";
        document.getElementById('vazgecBtn').style.display = "none";
        document.getElementById('kaydetBtn').style.display = "block";
        document.getElementById('isimInput').value = "";
        document.getElementById('soyadInput').value = "";
        document.getElementById('telefonInput').value = "";
        currentEditKey = null;

        Swal.fire({
            icon: 'success',
            title: 'GÃ¼ncellendi!',
            confirmButtonText: 'Tamam'
        });
        // KaydÄ±rma iÅŸlemi burada artÄ±k doÄŸrudan yapÄ±lmayacak,
        // Ã§Ã¼nkÃ¼ showContent listeyi yeni sÄ±raya gÃ¶re Ã§izecek.
    }).catch((error) => {
        Swal.fire({
            icon: 'error',
            title: 'Hata!',
            confirmButtonText: 'Tamam'
        });
        console.error(error);
    });
}
	
	//gÃ¼ncelleme esnasÄ±nda vazgeÃ§ butonu dinleme
document.getElementById('vazgecBtn').addEventListener('click', () => {
    // Formu temizle
    document.getElementById('isimInput').value = "";
    document.getElementById('soyadInput').value = "";
    document.getElementById('telefonInput').value = "";

    // ButonlarÄ± ayarla
    document.getElementById('guncelleBtn').style.display = "none";
    document.getElementById('vazgecBtn').style.display = "none";
    document.getElementById('kaydetBtn').style.display = "inline-block";

    currentEditKey = null;
});


    // Ã‡Ä±kÄ±ÅŸ Yapma Fonksiyonu
  function logout() {
    const user = firebase.auth().currentUser;
    if (user) {
        // Dinleyiciyi kaldÄ±r
        firebase.database().ref('kayitlar/' + user.uid).off();
    }
    
    firebase.auth().signOut().then(() => {
        document.getElementById('loginSection').style.display = "block";
        document.getElementById('kayitListesi').style.display = "none";
        document.getElementById('signupSection').style.display = "none";
        document.getElementById('emailInput').value = "";
        document.getElementById('passwordInput').value = "";
    }).catch((error) => {
        console.error("Ã‡Ä±kÄ±ÅŸ yapÄ±lamadÄ±: ", error);
    });
}

    // KayÄ±t EkranÄ±nÄ± GÃ¶ster
    function showSignup() {
        document.getElementById('signupSection').style.display = "block";
        document.getElementById('loginSection').style.display = "none";
    }

    // GiriÅŸ Yapma EkranÄ±na GÃ¶ster
    function showLogin() {
        document.getElementById('loginSection').style.display = "block";
        document.getElementById('signupSection').style.display = "none";
    }
	
	// Arama kutusuna yazÄ±ldÄ±kÃ§a filtreleme yapan fonksiyon
    document.getElementById("kelimeBul").addEventListener("input", function () {
        const arama = this.value.toLowerCase();
        const liste = document.querySelectorAll("#isimlerListesi li");

        liste.forEach(function (li) {
            const ad = li.querySelector("div span:nth-child(1)")?.textContent.toLowerCase() || "";
            const soyad = li.querySelector("div span:nth-child(2)")?.textContent.toLowerCase() || "";
            const telefon = li.querySelector("div span:nth-child(3)")?.textContent.toLowerCase() || "";

            if (ad.includes(arama) || soyad.includes(arama) || telefon.includes(arama)) {
                li.style.display = "flex"; // varsa gÃ¶ster
            } else {
                li.style.display = "none"; // yoksa gizle
            }
        });
    });
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

    // Not Ekle butonu aÃ§
    document.getElementById("notEkleBtn").addEventListener("click", () => {
        document.getElementById("notPopup").style.display = "block";
        document.body.classList.add("popup-acik");
        document.getElementById("notMetni").focus();
    });

    // Popup kapat
    function popupKapat() {
        document.getElementById("notPopup").style.display = "none";
        document.body.classList.remove("popup-acik");
        document.getElementById("notMetni").value = "";
    }

 


 
document.addEventListener('click', baslatOturumZamani);
document.addEventListener('keydown', baslatOturumZamani);


  document.addEventListener("DOMContentLoaded", function () {
    const kelimeInput = document.getElementById('kelimeBul');
    const temizleBtn = document.querySelector('.temizleBtn');

    kelimeInput.addEventListener('input', function () {
      if (this.value.trim() !== "") {
        temizleBtn.style.display = "block";
      } else {
        temizleBtn.style.display = "none";
      }
    });

    window.temizleInput = function () {
      kelimeInput.value = "";
      temizleBtn.style.display = "none";
      kelimeInput.focus();
	  // ğŸ”½ Arama filtrelemeyi tetiklemek iÃ§in input event'i tetikleniyor
  kelimeInput.dispatchEvent(new Event('input'));
    };
    });
	
	function notKaydet() {
    const metin = document.getElementById("notMetni").value.trim();
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    if (metin.length === 0) return;

    // AynÄ± yerde, aynÄ± anahtarla set yapÄ±yoruz
    firebase.database().ref('notlar/' + user.uid + '/not').set({
        metin: metin,
        tarih: new Date().toISOString()
    }).then(() => {
        popupKapat();
        notlariListele(); // Listeyi gÃ¼ncelle
    }).catch((error) => {
        console.error("Not kaydedilemedi:", error);
    });
}

// Popup aÃ§Ä±lÄ±rken kullanÄ±cÄ± notunu Ã§ekip textarea'ya yaz
function notGetir() {
    const user = firebase.auth().currentUser;

    if (!user) return;

    firebase.database().ref('notlar/' + user.uid + '/not').once('value')
    .then(snapshot => {
        const data = snapshot.val();
        if (data && data.metin) {
            document.getElementById("notMetni").value = data.metin;
        } else {
            document.getElementById("notMetni").value = '';
        }
    }).catch(error => {
        console.error("Not getirilemedi:", error);
    });
}


// Not Ekle butonu aÃ§
document.getElementById("notEkleBtn").addEventListener("click", () => {
    document.getElementById("notPopup").style.display = "block";
    document.body.classList.add("popup-acik");
    notGetir(); // ğŸ”½ Bu satÄ±r eklendi: Popup aÃ§Ä±lÄ±rken mevcut notu yÃ¼kle
    document.getElementById("notMetni").focus();
});

// Not kaydetme fonksiyonu (mevcut hali doÄŸru, sadece feedback ekleyelim)
function notKaydet() {
    const metin = document.getElementById("notMetni").value.trim();
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    if (metin.length === 0) {
        Swal.fire({
            text: 'LÃ¼tfen bir not yazÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    firebase.database().ref('notlar/' + user.uid + '/not').set({
        metin: metin,
        tarih: new Date().toISOString()
    }).then(() => {
        Swal.fire({
            icon: 'success',
            title: 'Not kaydedildi!',
            showConfirmButton: false,
            timer: 1500
        });
        popupKapat();
    }).catch((error) => {
        console.error("Not kaydedilemedi:", error);
        Swal.fire({
            icon: 'error',
            title: 'Hata!',
            text: 'Not kaydedilirken bir sorun oluÅŸtu',
            confirmButtonText: 'Tamam'
        });
    });
}




 // EmailJS baÅŸlatma (kendi bilgilerinizle deÄŸiÅŸtirin)
    emailjs.init('VCwxBwdvT-HFnnKZ0'); // EmailJS dashboard > Integration > API Keys

   

   
	
	
	
	// Dropdown aÃ§/kapa
document.querySelector('.dropdown-btn').addEventListener('click', function() {
  document.querySelector('.dropdown-content').classList.toggle('show');
});

// DÄ±ÅŸarÄ± tÄ±klandÄ±ÄŸÄ±nda kapat
window.addEventListener('click', function(e) {
  if (!e.target.matches('.dropdown-btn')) {
    const dropdowns = document.querySelectorAll('.dropdown-content');
    dropdowns.forEach(dropdown => {
      if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
      }
    });
  }
});



function iletisimFormuGoster() {
  Swal.fire({
    title: 'ğŸ“¬ Bize UlaÅŸÄ±n',
    html:
      '<input id="swal-ad" class="swal2-input" placeholder="AdÄ±nÄ±z">' +
      '<input id="swal-email" class="swal2-input" placeholder="E-posta" type="email">' +
      '<textarea id="swal-mesaj" class="swal2-textarea" placeholder="MesajÄ±nÄ±z..."></textarea>',
    focusConfirm: false,
    showCancelButton: true,
    confirmButtonText: 'GÃ¶nder',
    cancelButtonText: 'Ä°ptal',
    preConfirm: () => {
      return {
        ad: document.getElementById('swal-ad').value,
        email: document.getElementById('swal-email').value,
        mesaj: document.getElementById('swal-mesaj').value
      }
    }
  }).then((result) => {
    if (result.isConfirmed) {
      // Form gÃ¶nderim iÅŸlemi
      const params = {
        name: result.value.ad,
        email: result.value.email,
        message: result.value.mesaj,
        time: new Date().toLocaleString('tr-TR', { 
          day: 'numeric', 
          month: 'long', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        })
      };

      emailjs.send("service_8ofb079","template_80rg1o1",params)
        .then(() => {
          Swal.fire('BaÅŸarÄ±lÄ±!', 'MesajÄ±nÄ±z gÃ¶nderildi', 'success');
        }, (error) => {
          Swal.fire('Hata!', 'Mesaj gÃ¶nderilemedi: ' + error.text, 'error');
        });
    }
  });
}

// Ä°letiÅŸim formunu aÃ§
// Dropdown menÃ¼deki tÄ±klamalarÄ± SweetAlert ile deÄŸiÅŸtir
document.getElementById('iletisimAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  iletisimFormuGoster();
});



// Ayarlar ve YardÄ±m iÃ§in boÅŸ fonksiyonlar (ÅÄ°MDÄ° GÃœNCELLENECEK)
document.getElementById('ayarlarAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show'); // AÃ§Ä±k dropdown'Ä± kapat

  Swal.fire({
    title: 'âš™ï¸ Ayarlar',
    html: `
      <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
        <button id="ayarlarEmailDegistir" class="swal2-styled">ğŸ“§ E-posta DeÄŸiÅŸtir</button>
        <button id="ayarlarNotlariIndir" class="swal2-styled">â¬‡ï¸ NotlarÄ± Ä°ndir</button>
		 <button id="ayarlarNotlariYukle" class="swal2-styled">â¬†ï¸ NotlarÄ± YÃ¼kle/Geri YÃ¼kle</button>
		 <button id="ayarlarDriveYedekle" class="swal2-styled">ğŸ§© Google Driveâ€™a Yedekle</button>

		<button id="ayarlarSifreDegistir" class="swal2-styled">ğŸ”’ Åifre DeÄŸiÅŸtir</button>
        <button id="ayarlarHesapSil" class="swal2-styled" style="background-color: #e53935;">ğŸ—‘ï¸ HesabÄ± Sil</button> </div>
    `,
    showConfirmButton: false, // VarsayÄ±lan "Tamam" butonunu gizle
    showCloseButton: true, // SaÄŸ Ã¼st kÃ¶ÅŸeye kapatma butonu ekle
    customClass: {
        container: 'swal2-container-ayarlar' // Ã–zel CSS sÄ±nÄ±fÄ±, eÄŸer popup'Ä± daha da Ã¶zelleÅŸtirmek isterseniz
    },
    didOpen: () => {
	
      // Pop-up aÃ§Ä±ldÄ±ktan sonra butonlara olay dinleyicisi ekle
	  
	  document.getElementById('ayarlarSifreDegistir').addEventListener('click', () => { // YENÄ°: Åifre DeÄŸiÅŸtir dinleyicisi
        Swal.close(); 
        degistirSifre(); // ÅŸifre deÄŸiÅŸtirme fonksiyonu Ã§aÄŸÄ±r
      });
	  document.getElementById('ayarlarDriveYedekle').addEventListener('click', () => {
  Swal.close();
  yedekleDrive();
});


      document.getElementById('ayarlarEmailDegistir').addEventListener('click', () => {
        Swal.close(); // SweetAlert'i kapat
        degistirEmail(); // E-posta deÄŸiÅŸtirme fonksiyonunu Ã§aÄŸÄ±r
      });
	  
      document.getElementById('ayarlarNotlariIndir').addEventListener('click', () => {
        Swal.close(); // SweetAlert'i kapat
        notlariIndir(); // NotlarÄ± indirme fonksiyonunu Ã§aÄŸÄ±r
      });
	  
	  
	     // *** BURAYA YENÄ° EKLENECEK KOD ***
            document.getElementById('ayarlarNotlariYukle').addEventListener('click', () => {
                Swal.close(); // Ana ayarlar modalÄ±nÄ± kapat
                Swal.fire({
                    title: 'â¬†ï¸ Not YÃ¼kle/Geri YÃ¼kle',
                    html: `
                        <p style="color: #ccc; margin-top: 15px;">Ä°ndirdiÄŸiniz not defteri dosyasÄ±nÄ± (.json) buradan yÃ¼kleyerek notlarÄ±nÄ±zÄ± geri yÃ¼kleyebilirsiniz. <strong style="color: #f00;">Bu iÅŸlem mevcut notlarÄ±nÄ±zÄ±n Ã¼zerine yazabilir!</strong></p>
                        <input type="file" id="swalUploadNotesInput" accept=".json" style="display: none;">
                        <label for="swalUploadNotesInput" class="custom-file-upload-button-swal">Dosya SeÃ§</label>
                        <p class="file-info-swal" id="swalSelectedFileName"></p>
                    `,
                    showCancelButton: true,
                    cancelButtonText: 'Ä°ptal',
                    showConfirmButton: false, // "YÃ¼kle" butonunu manuel kontrol edeceÄŸiz
                    showCloseButton: true,
                    customClass: {
                        container: 'swal2-container-upload'
                    },
                    didOpen: () => {
                        const uploadInput = document.getElementById('swalUploadNotesInput');
                        const fileNameDisplay = document.getElementById('swalSelectedFileName');

                        uploadInput.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                fileNameDisplay.textContent = `SeÃ§ilen Dosya: ${file.name}`;
                                // YÃ¼kle butonunu etkinleÅŸtir veya gÃ¶ster (isterseniz)
                                // Åu an iÃ§in direkt handleFileUpload'Ä± Ã§aÄŸÄ±racaÄŸÄ±z.
                            } else {
                                fileNameDisplay.textContent = '';
                            }
                        });

                        // Dosya seÃ§ildiÄŸinde direkt yÃ¼kleme iÅŸlemini baÅŸlatmak iÃ§in
                        document.querySelector('.custom-file-upload-button-swal').addEventListener('click', () => {
                            uploadInput.click(); // Hidden input'u tÄ±kla
                        });

                        // KullanÄ±cÄ± dosya seÃ§tikten sonra doÄŸrudan handleFileUpload'Ä± Ã§aÄŸÄ±rabiliriz
                        uploadInput.addEventListener('change', handleFileUpload); // Ã–nceki yanÄ±ttaki handleFileUpload fonksiyonu
                    }
                });
            });
            // *** YENÄ° KOD BURADA BÄ°TTÄ° ***
			
			
      document.getElementById('ayarlarHesapSil').addEventListener('click', () => { // Yeni buton dinleyicisi
        Swal.close(); // SweetAlert'i kapat
        hesapSil(); // Hesap silme fonksiyonunu Ã§aÄŸÄ±r
      });
	  
    }
  });
});










function notlariIndir() {
    const user = firebase.auth().currentUser;
    if (!user) {
        Swal.fire('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!');
        return;
    }

    Promise.all([
        firebase.database().ref('notlar/' + user.uid + '/not').once('value'),
        firebase.database().ref('kayitlar/' + user.uid).once('value')
    ]).then(([notSnapshot, kayitSnapshot]) => {
        const data = {
            notlar: notSnapshot.val() || {},
            kayitlar: kayitSnapshot.val() || {}
        };

        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json;charset=utf-8' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = `not_defteri_${new Date().toISOString().slice(0, 10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        Swal.fire({
            icon: 'success',
            title: 'Veriler .json olarak indirildi!',
            showConfirmButton: false,
            timer: 1500
        });
    }).catch(error => {
        console.error("Ä°ndirme hatasÄ±:", error);
        Swal.fire('Veri indirilemedi!');
    });
}

let kullaniciSifresi = ""; // global

// Åifre SÄ±fÄ±rlama Fonksiyonu
function resetPassword() {
    Swal.fire({
        title: 'Åifre SÄ±fÄ±rlama',
        input: 'email',
        inputLabel: 'Åifresini sÄ±fÄ±rlamak istediÄŸiniz e-posta adresinizi girin:',
        inputPlaceholder: 'E-posta adresiniz',
        showCancelButton: true,
        confirmButtonText: 'Åifre SÄ±fÄ±rla',
        cancelButtonText: 'Ä°ptal',
        inputValidator: (value) => {
            if (!value) {
                return 'E-posta adresi boÅŸ bÄ±rakÄ±lamaz!';
            }
            // Basit bir e-posta format kontrolÃ¼
            if (!/\S+@\S+\.\S+/.test(value)) {
                return 'LÃ¼tfen geÃ§erli bir e-posta adresi girin!';
            }
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const email = result.value;

            firebase.auth().sendPasswordResetEmail(email)
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Åifre SÄ±fÄ±rlama BaÄŸlantÄ±sÄ± GÃ¶nderildi',
                        text: 'Åifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± e-posta adresinize gÃ¶nderildi. LÃ¼tfen gelen kutunuzu kontrol edin.'
                    });
                })
                .catch((error) => {
                    let errorMessage = "Bilinmeyen bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.";

                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'GeÃ§ersiz e-posta adresi. LÃ¼tfen doÄŸru bir e-posta formatÄ± girin.';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'Bu e-posta adresiyle kayÄ±tlÄ± bir kullanÄ±cÄ± bulunamadÄ±.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                            break;
                        default:
                            errorMessage = `Åifre sÄ±fÄ±rlanÄ±rken bir hata oluÅŸtu: ${error.message}`;
                            break;
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'Hata',
                        text: errorMessage
                    });
                    console.error("Åifre SÄ±fÄ±rlama HatasÄ±:", error);
                });
        }
    });
}


// E-posta DeÄŸiÅŸtirme Fonksiyonu
// "E-posta DeÄŸiÅŸtir" linkine tÄ±klama olayÄ±nÄ± dinle
document.getElementById('emailDegistirAc').addEventListener('click', function(e) {
  e.preventDefault(); // VarsayÄ±lan link davranÄ±ÅŸÄ±nÄ± engelle
  document.querySelector('.dropdown-content').classList.remove('show'); // AÃ§Ä±k dropdown'Ä± kapat
  degistirEmail(); // Fonksiyonu Ã§aÄŸÄ±r
});


// E-posta DeÄŸiÅŸtirme Fonksiyonu
function degistirEmail() {
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    Swal.fire({
        title: 'E-posta Adresini DeÄŸiÅŸtir',
        html:
            `<input id="swal-old-email" class="swal2-input" placeholder="Mevcut E-posta Adresiniz" type="email" value="${user.email || ''}" disabled>` +
            '<input id="swal-new-email" class="swal2-input" placeholder="Yeni E-posta Adresiniz" type="email">' +
            '<input id="swal-password" class="swal2-input" placeholder="Åifreniz" type="password">',
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'DeÄŸiÅŸtir',
        cancelButtonText: 'Ä°ptal',
        preConfirm: () => {
            const newEmail = document.getElementById('swal-new-email').value.trim();
            const password = document.getElementById('swal-password').value.trim();

            if (!newEmail || !password) {
                Swal.showValidationMessage('TÃ¼m alanlarÄ± doldurmanÄ±z gerekmektedir.');
                return false;
            }
            if (!/\S+@\S+\.\S+/.test(newEmail)) {
                Swal.showValidationMessage('LÃ¼tfen geÃ§erli bir yeni e-posta adresi girin.');
                return false;
            }
            if (newEmail === user.email) {
                 Swal.showValidationMessage('Yeni e-posta adresiniz mevcut e-posta adresinizle aynÄ± olamaz.');
                 return false;
            }

            return { newEmail: newEmail, password: password };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const { newEmail, password } = result.value;

            // KullanÄ±cÄ±nÄ±n kimliÄŸini tekrar doÄŸrula
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, password);

            user.reauthenticateWithCredential(credential)
                .then(() => {
                    // Kimlik doÄŸrulandÄ±, ÅŸimdi e-postayÄ± gÃ¼ncelle
                    user.updateEmail(newEmail)
                        .then(() => {
                            Swal.fire({
                                icon: 'success',
                                title: 'E-posta DeÄŸiÅŸtirildi!',
                                html: `E-posta adresiniz baÅŸarÄ±yla <strong>${newEmail}</strong> olarak ayarlandÄ±. <br> Yeni e-postanÄ±za gÃ¶nderilen doÄŸrulama linkine tÄ±klayarak e-posta adresinizi doÄŸrulamanÄ±z gerekmektedir.`,
                                confirmButtonText: 'Tamam'
                            });
                            // HoÅŸgeldin yazÄ±sÄ±nÄ± da gÃ¼ncelle (geÃ§ici olarak, doÄŸrulama sonrasÄ± kalÄ±cÄ± olacak)
                            document.getElementById('hosgeldinYazi').textContent = `HoÅŸ geldiniz, ${newEmail}`;
                        })
                        .catch((error) => {
                            let errorMessage = "E-posta gÃ¼ncellenirken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.";
                            console.error("E-posta GÃ¼ncelleme HatasÄ±:", error);

                            if (error.code) {
                                switch (error.code) {
                                    case 'auth/invalid-email':
                                        errorMessage = 'GeÃ§ersiz yeni e-posta adresi formatÄ±.';
                                        break;
                                    case 'auth/email-already-in-use':
                                        errorMessage = 'Bu yeni e-posta adresi zaten baÅŸka bir hesap tarafÄ±ndan kullanÄ±lÄ±yor.';
                                        break;
                                    case 'auth/requires-recent-login':
                                        errorMessage = 'GÃ¼venlik nedeniyle, bu iÅŸlem iÃ§in yakÄ±n zamanda tekrar giriÅŸ yapmanÄ±z gerekmektedir.';
                                        break;
                                    case 'auth/network-request-failed':
                                        errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                                        break;
                                    default:
                                        // Hata mesajÄ± iÃ§inde "verify the new email" veya "change email" ifadelerini arayalÄ±m
                                        // JSON ayrÄ±ÅŸtÄ±rma denemesi
                                        try {
                                            const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{')));
                                            if (parsedMessage.error && parsedMessage.error.message && parsedMessage.error.message.includes("verify the new email")) {
                                                errorMessage = 'Yeni e-posta adresinizi deÄŸiÅŸtirmeden Ã¶nce doÄŸrulamanÄ±z gerekmektedir. LÃ¼tfen yeni e-postanÄ±za gÃ¶nderilen doÄŸrulama linkine tÄ±klayÄ±n.';
                                            } else {
                                                errorMessage = `E-posta gÃ¼ncellenirken bir hata oluÅŸtu: ${error.message}`;
                                            }
                                        } catch (e) {
                                            // EÄŸer error.message JSON deÄŸilse, sadece includes() ile kontrol ederiz
                                            if (error.message && error.message.includes("verify the new email")) {
                                                errorMessage = 'Yeni e-posta adresinizi deÄŸiÅŸtirmeden Ã¶nce doÄŸrulamanÄ±z gerekmektedir. LÃ¼tfen yeni e-postanÄ±za gÃ¶nderilen doÄŸrulama linkine tÄ±klayÄ±n.';
                                            } else {
                                                errorMessage = `E-posta gÃ¼ncellenirken bir hata oluÅŸtu: ${error.message}`;
                                            }
                                        }
                                        break;
                                }
                            } else if (error.message && error.message.includes("verify the new email")) {
                                errorMessage = 'Yeni e-posta adresinizi deÄŸiÅŸtirmeden Ã¶nce doÄŸrulamanÄ±z gerekmektedir. LÃ¼tfen yeni e-postanÄ±za gÃ¶nderilen doÄŸrulama linkine tÄ±klayÄ±n.';
                            } else {
                                errorMessage = `E-posta gÃ¼ncellenirken bir hata oluÅŸtu: ${error.message}`;
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Hata',
                                text: errorMessage
                            });
                        });
                })
                .catch((error) => {
                    let errorMessage = "Mevcut ÅŸifreniz yanlÄ±ÅŸ. LÃ¼tfen tekrar deneyin.";
                    console.error("Kimlik DoÄŸrulama HatasÄ±:", error);

                    if (error.code) {
                        switch (error.code) {
                            case 'auth/wrong-password':
                            case 'auth/invalid-credential':
                                errorMessage = 'Mevcut ÅŸifreniz yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                                break;
                            case 'auth/user-not-found':
                                errorMessage = 'KullanÄ±cÄ± bulunamadÄ±. LÃ¼tfen tekrar giriÅŸ yapÄ±n.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'E-posta formatÄ± hatalÄ±.';
                                break;
                            case 'auth/requires-recent-login':
                                errorMessage = 'GÃ¼venlik nedeniyle, bu iÅŸlem iÃ§in yakÄ±n zamanda tekrar giriÅŸ yapmanÄ±z gerekmektedir.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                                break;
                            default:
                                // Genel hata mesajÄ± iÃ§in JSON ayrÄ±ÅŸtÄ±rma denemesi
                                try {
                                    const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{')));
                                    if (parsedMessage.error && parsedMessage.error.message === "INVALID_LOGIN_CREDENTIALS") {
                                        errorMessage = 'Mevcut ÅŸifreniz yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                                    } else {
                                        errorMessage = `Kimlik doÄŸrulama sÄ±rasÄ±nda bir hata oluÅŸtu: ${error.message}`;
                                    }
                                } catch (e) {
                                    if (error.message && error.message.includes("INVALID_LOGIN_CREDENTIALS")) {
                                        errorMessage = 'Mevcut ÅŸifreniz yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                                    } else {
                                        errorMessage = `Kimlik doÄŸrulama sÄ±rasÄ±nda bir hata oluÅŸtu: ${error.message}`;
                                    }
                                }
                                break;
                        }
                    } else if (error.message) {
                        // EÄŸer error.code yoksa ama error.message var ise genel hata mesajÄ±
                        try { // error.message'Ä±n bir JSON olduÄŸunu varsayÄ±p ayrÄ±ÅŸtÄ±rmayÄ± deneriz
                            const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{')));
                            if (parsedMessage.error && parsedMessage.error.message === "INVALID_LOGIN_CREDENTIALS") {
                                errorMessage = 'Mevcut ÅŸifreniz yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                            } else {
                                errorMessage = `Kimlik doÄŸrulama sÄ±rasÄ±nda bir hata oluÅŸtu: ${error.message}`;
                            }
                        } catch (e) { // EÄŸer error.message JSON deÄŸilse, sadece includes ile kontrol ederiz
                            if (error.message.includes("INVALID_LOGIN_CREDENTIALS")) {
                                errorMessage = 'Mevcut ÅŸifreniz yanlÄ±ÅŸ. LÃ¼tfen bilgilerinizi kontrol edip tekrar deneyin.';
                            } else {
                                errorMessage = `Kimlik doÄŸrulama sÄ±rasÄ±nda bir hata oluÅŸtu: ${error.message}`;
                            }
                        }
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'Kimlik DoÄŸrulama HatasÄ±',
                        text: errorMessage
                    });
                });
        }
    });
}


// Åifre GÃ¶ster/Gizle Fonksiyonu
function togglePasswordVisibility(inputId, iconElement) {
    const passwordInput = document.getElementById(inputId);
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        iconElement.textContent = 'ğŸ™ˆ'; // GÃ¶z ikonunu kapalÄ± gÃ¶ze Ã§evir
    } else {
        passwordInput.type = 'password';
        iconElement.textContent = 'ğŸµ'; // GÃ¶z ikonunu aÃ§Ä±k gÃ¶ze Ã§evir
    }
}


// YENÄ° FONKSÄ°YON: Hesap Silme Ä°ÅŸlemi
function hesapSil() {
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    Swal.fire({
        title: 'HesabÄ± KalÄ±cÄ± Olarak Sil?',
        html: `
            <p style="color: #ffcc00; font-weight: bold;">Bu iÅŸlem geri alÄ±namaz!</p>
            <p>TÃ¼m notlarÄ±nÄ±z ve kayÄ±tlarÄ±nÄ±z kalÄ±cÄ± olarak silinecektir.</p>
            <input type="password" id="hesapSilSifre" class="swal2-input" placeholder="HesabÄ±nÄ±zÄ±n ÅŸifresini girin">
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e53935', // KÄ±rmÄ±zÄ± renk
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Evet, HesabÄ± Sil!',
        cancelButtonText: 'VazgeÃ§',
        preConfirm: () => {
            const password = document.getElementById('hesapSilSifre').value.trim();
            if (!password) {
                Swal.showValidationMessage('HesabÄ± silmek iÃ§in ÅŸifrenizi girmeniz gerekmektedir.');
                return false;
            }
            return password;
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const password = result.value;
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, password);

            // KullanÄ±cÄ±nÄ±n kimliÄŸini tekrar doÄŸrula
            user.reauthenticateWithCredential(credential)
                .then(() => {
                    // Kimlik doÄŸrulandÄ±, ÅŸimdi Realtime Database'deki verileri sil
                    return firebase.database().ref('notlar/' + user.uid).remove()
                        .then(() => firebase.database().ref('kayitlar/' + user.uid).remove());
                })
                .then(() => {
                    // VeritabanÄ±ndaki veriler silindi, ÅŸimdi kullanÄ±cÄ± hesabÄ±nÄ± sil
                    return user.delete();
                })
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Hesap Silindi',
                        text: 'HesabÄ±nÄ±z ve tÃ¼m verileriniz baÅŸarÄ±yla silindi.',
                        confirmButtonText: 'Tamam'
                    }).then(() => {
                        logout(); // HesabÄ± sildikten sonra Ã§Ä±kÄ±ÅŸ yap ve giriÅŸ ekranÄ±na dÃ¶n
                    });
                })
                .catch((error) => {
                    console.error("Hesap silme hatasÄ±:", error);
                    let errorMessage = "Hesap silinirken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.";

                    switch (error.code) {
                        case 'auth/wrong-password':
                        case 'auth/invalid-credential':
                            errorMessage = 'GirdiÄŸiniz ÅŸifre yanlÄ±ÅŸ.';
                            break;
                        case 'auth/requires-recent-login':
                            errorMessage = 'GÃ¼venlik nedeniyle, bu iÅŸlem iÃ§in lÃ¼tfen yakÄ±n zamanda tekrar giriÅŸ yapÄ±n.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                            break;
                        default:
                            errorMessage = `Hesap silinirken bir hata oluÅŸtu: ${error.message}`;
                            break;
                    }
                    Swal.fire({
                        icon: 'error',
                        title: 'Hesap Silme HatasÄ±',
                        text: errorMessage
                    });
                });
        }
    });
}


// YENÄ° FONKSÄ°YON: Åifre DeÄŸiÅŸtirme Ä°ÅŸlemi
function degistirSifre() {
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    Swal.fire({
        title: 'Åifrenizi DeÄŸiÅŸtirin',
        html: `
            <input type="password" id="mevcutSifreInput" class="swal2-input" placeholder="Mevcut Åifreniz">
            <input type="password" id="yeniSifreInput" class="swal2-input" placeholder="Yeni Åifreniz">
            <input type="password" id="yeniSifreTekrarInput" class="swal2-input" placeholder="Yeni Åifre (Tekrar)">
        `,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'Åifreyi DeÄŸiÅŸtir',
        cancelButtonText: 'Ä°ptal',
        preConfirm: () => {
            const mevcutSifre = document.getElementById('mevcutSifreInput').value.trim();
            const yeniSifre = document.getElementById('yeniSifreInput').value.trim();
            const yeniSifreTekrar = document.getElementById('yeniSifreTekrarInput').value.trim();

            if (!mevcutSifre || !yeniSifre || !yeniSifreTekrar) {
                Swal.showValidationMessage('TÃ¼m alanlarÄ± doldurmanÄ±z gerekmektedir.');
                return false;
            }
            if (yeniSifre.length < 6) {
                Swal.showValidationMessage('Yeni ÅŸifre en az 6 karakter olmalÄ±dÄ±r.');
                return false;
            }
            if (yeniSifre !== yeniSifreTekrar) {
                Swal.showValidationMessage('Yeni ÅŸifreler eÅŸleÅŸmiyor.');
                return false;
            }
            if (mevcutSifre === yeniSifre) {
                Swal.showValidationMessage('Yeni ÅŸifreniz mevcut ÅŸifrenizle aynÄ± olamaz.');
                return false;
            }
            return { mevcutSifre, yeniSifre };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const { mevcutSifre, yeniSifre } = result.value;
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, mevcutSifre);

            user.reauthenticateWithCredential(credential)
                .then(() => {
                    user.updatePassword(yeniSifre)
                        .then(() => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Åifre DeÄŸiÅŸtirildi!',
                                text: 'Åifreniz baÅŸarÄ±yla gÃ¼ncellendi.',
                                confirmButtonText: 'Tamam'
                            });
                        })
                        .catch((error) => {
                            console.error("Åifre gÃ¼ncelleme hatasÄ±:", error);
                            let errorMessage = "Åifre gÃ¼ncellenirken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.";
                            switch (error.code) {
                                case 'auth/requires-recent-login':
                                    errorMessage = 'GÃ¼venlik nedeniyle, bu iÅŸlem iÃ§in yakÄ±n zamanda tekrar giriÅŸ yapmanÄ±z gerekmektedir.';
                                    break;
                                case 'auth/weak-password':
                                    errorMessage = 'Åifre Ã§ok zayÄ±f. LÃ¼tfen en az 6 karakterli gÃ¼Ã§lÃ¼ bir ÅŸifre belirleyin.';
                                    break;
                                case 'auth/network-request-failed':
                                    errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                                    break;
                                default:
                                    errorMessage = `Åifre gÃ¼ncellenirken bir hata oluÅŸtu: ${error.message}`;
                                    break;
                            }
                            Swal.fire({
                                icon: 'error',
                                title: 'Åifre DeÄŸiÅŸtirme HatasÄ±',
                                text: errorMessage
                            });
                        });
                })
                .catch((error) => {
                    console.error("Åifre yeniden kimlik doÄŸrulama hatasÄ±:", error);
                    let errorMessage = "Mevcut ÅŸifreniz yanlÄ±ÅŸ veya bir hata oluÅŸtu.";
                    switch (error.code) {
                        case 'auth/wrong-password':
                        case 'auth/invalid-credential':
                            errorMessage = 'Mevcut ÅŸifreniz yanlÄ±ÅŸ.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'Ä°nternet baÄŸlantÄ±nÄ±zda bir sorun var. LÃ¼tfen baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                            break;
                        default:
                            errorMessage = `Kimlik doÄŸrulama sÄ±rasÄ±nda bir hata oluÅŸtu: ${error.message}`;
                            break;
                    }
                    Swal.fire({
                        icon: 'error',
                        title: 'Kimlik DoÄŸrulama HatasÄ±',
                        text: errorMessage
                    });
                });
        }
    });
}






function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        try {
            const jsonData = JSON.parse(e.target.result);
            const user = firebase.auth().currentUser;
            if (!user) {
                Swal.fire('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!');
                return;
            }

            // NotlarÄ± ve kayÄ±tlarÄ± ayrÄ± ayrÄ± Firebase'e yaz
            const updates = [];
            if (jsonData.notlar) {
                updates.push(firebase.database().ref('notlar/' + user.uid + '/not').set(jsonData.notlar));
            }
            if (jsonData.kayitlar) {
                updates.push(firebase.database().ref('kayitlar/' + user.uid).set(jsonData.kayitlar));
            }

            Promise.all(updates).then(() => {
                Swal.fire('âœ”ï¸ Veriler baÅŸarÄ±yla yÃ¼klendi!');
                showContent(user.uid); // Listeyi gÃ¼ncelle
            }).catch(err => {
                console.error('YÃ¼kleme hatasÄ±:', err);
                Swal.fire('Hata! Veriler yÃ¼klenemedi.');
            });

        } catch (err) {
            console.error('JSON ayrÄ±ÅŸtÄ±rma hatasÄ±:', err);
            Swal.fire('HatalÄ± dosya formatÄ±!');
        }
    };

    reader.readAsText(file);
}





let GoogleAuth;
const CLIENT_ID = "344034966705-8paqve5db6002isrh7ahjk6s2e1ps4ob.apps.googleusercontent.com";
const SCOPES = 'https://www.googleapis.com/auth/drive.file';


function initGoogleAuth() {
    gapi.load('client:auth2', () => {
        gapi.client.init({
            clientId: CLIENT_ID,
            scope: SCOPES
        }).then(() => {
            GoogleAuth = gapi.auth2.getAuthInstance();
        }).catch(error => {
            console.error('Google API init hatasÄ±:', error);
        });
    });
}

window.onload = function () {
    const script = document.createElement("script");
    script.src = "https://apis.google.com/js/api.js";
    script.onload = initGoogleAuth;
    document.head.appendChild(script);
};


function yedekleDrive() {
    const user = firebase.auth().currentUser;
    if (!user) {
        Swal.fire('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!');
        return;
    }

    GoogleAuth.signIn().then(() => {
        const googleUser = GoogleAuth.currentUser.get();
        const accessToken = googleUser.getAuthResponse().access_token;

        Promise.all([
            firebase.database().ref('notlar/' + user.uid + '/not').once('value'),
            firebase.database().ref('kayitlar/' + user.uid).once('value')
        ]).then(([notSnapshot, kayitSnapshot]) => {
            const data = {
                notlar: notSnapshot.val() || {},
                kayitlar: kayitSnapshot.val() || {}
            };

            const fileContent = JSON.stringify(data, null, 2);
            const blob = new Blob([fileContent], { type: 'application/json' });

            const metadata = {
                name: `not_yedegi_${new Date().toISOString().slice(0, 10)}.json`,
                mimeType: 'application/json'
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', blob);

            fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                body: form
            }).then(response => response.json())
              .then(data => {
                Swal.fire('âœ… Google Driveâ€™a baÅŸarÄ±yla yÃ¼klendi!');
              }).catch(err => {
                console.error("YÃ¼kleme hatasÄ±:", err);
                Swal.fire('âŒ Driveâ€™a yÃ¼klenemedi!');
              });
        });
    }).catch(error => {
        console.error("Google giriÅŸ hatasÄ±:", error);
        Swal.fire('Google hesabÄ±na giriÅŸ yapÄ±lamadÄ±.');
    });
}


       
</script>


    <footer class="app-footer">
        <div class="footer-content">
            <p>Uygulama SÃ¼rÃ¼mÃ¼: 1.0.0</p>
            <p class="footer-links">
                <a href="/gizlilik-politikasi.html">Gizlilik PolitikasÄ±</a> |
                <a href="/kullanim-kosullari.html">KullanÄ±m KoÅŸullarÄ±</a>
            </p>
            <p>&copy; 2025 Note's. TÃ¼m HaklarÄ± SaklÄ±dÄ±r.</p>
        </div>
    </footer>

   </body>
</html>









